<?phprequire_once('connection.php');require_once('email.class.php');require_once('mailerClass.php');require_once('resizeclass.php');class User extends Connection{    function getUserInfo($user_id){        $query=mysql_query("SELECT * FROM sr_users WHERE user_id='".$user_id."'");        $result=mysql_fetch_assoc($query);        return $result;    }function getUserAddress($user_id){    $query = mysql_query("select * from sr_users where user_id = '".$user_id."'");    $result = mysql_fetch_array($query);    return $result['location'];}    function __construct(){	   $this->createConnection();	}    function isRememberMe(){		if (!empty($_COOKIE['remember'])) {			list($selector, $token) = explode(':', $_COOKIE['remember']);			$rememberMeQuery= mysql_query("SELECT * FROM auth_tokens WHERE selector = '".$selector."'");			if($rememberMeQuery && mysql_num_rows($rememberMeQuery)){				$rememberMeResult = mysql_fetch_assoc($rememberMeQuery);				if (strcmp($rememberMeResult['token'], hash('sha256', base64_decode($token))) == 0) {					$_SESSION['user_id'] = $rememberMeResult['user_id'];					$this->generateLoginToken($rememberMeResult['user_id']);					return 1;				}			}else{				return 0;			}		}else{			return 0;		}	}    function getUserNotInterested($user_id)	{		$query=mysql_query("select is_notInterestedChecked from sr_users where user_id=$user_id");		$res=mysql_fetch_array($query);		return $res['is_notInterestedChecked'];	}    function generateLoginToken($user_id){		$selector = base64_encode($this->generateRandomString(9));		$token = $this->generateRandomString(33);		setcookie(			'remember',			 $selector.':'.base64_encode($token),			 time() + 864000,'/'); //or die('unable to create cookie');		$rememberMeQuery= mysql_query("SELECT * FROM auth_tokens WHERE user_id = '".$user_id."'");			if($rememberMeQuery && mysql_num_rows($rememberMeQuery) == 0){				$rememberMeQuery = mysql_query("INSERT INTO auth_tokens SET selector = '".$selector."', token = '".hash('sha256', $token)."', user_id = '".$user_id."', expires= '".date('Y-m-d\TH:i:s', time() + 864000)."'");			}else{				$rememberMeQuery = mysql_query("UPDATE auth_tokens SET selector = '".$selector."', token = '".hash('sha256', $token)."', expires= '".date('Y-m-d\TH:i:s', time() + 864000)."' WHERE user_id = '".$user_id."'");			}	}    function getrejectedphotos($user_id)	{		//echo "select * from sr_user_photo where status=2 AND is_usernotified=0 AND user_id=$user_id";		$query=mysql_query("select * from sr_user_photo where status=2 AND is_usernotified=0 AND user_id=$user_id");		if(mysql_num_rows($query)>0)		{			while($array=mysql_fetch_array($query))			{				$arr[]=$array;			}		}		return $arr;	}	function isUser($user_id , $userId){		$count = 0;		//echo "SELECT user_id FROM sr_users WHERE user_id='".$userId."' AND user_id != '".$user_id."'";		$query=mysql_query("SELECT user_id FROM sr_users WHERE user_id='".$userId."' AND user_id != '".$user_id."'");		if($query){			$count = mysql_num_rows($query);		}		return $count;	}	/***************HERE TO******************/	function getHereTo(){		$array = array();		$query=mysql_query("SELECT * FROM sr_here_to WHERE status=1");		if($query){			while($result=mysql_fetch_assoc($query)){				$array[] = $result;			}		}		return $array;	}	function getHereToName($here_to_id){		$here_to ='';		$query=mysql_query("SELECT here_to FROM sr_here_to WHERE here_to_id = '".$here_to_id."'");		if($query){			$result=mysql_fetch_assoc($query);				$here_to = $result['here_to'];		}		return $here_to;	}	/***************RELATIONSHIP STATUS******************/	function getRelationship(){		$array = array();		$query=mysql_query("SELECT * FROM sr_relationship_status WHERE status=1");		if($query){			while($result=mysql_fetch_assoc($query)){				$array[] = $result;			}		}		return $array;	}	function getRelationshipName($relationship_id){		$relationship_status ='';		$query=mysql_query("SELECT relationship_status FROM sr_relationship_status WHERE relationship_id = '".$relationship_id."'");		if($query){			$result=mysql_fetch_assoc($query);				$relationship_status = $result['relationship_status'];		}		return $relationship_status;	}	/***************STAR SIGN******************/	function getstarSign(){		$array = array();		$query=mysql_query("SELECT * FROM  sr_star_sign WHERE status=1");		if($query){			while($result=mysql_fetch_assoc($query)){				$array[] = $result;			}		}		return $array;	}	function getstarSignName($sign_id){		$star_sign ='';		$query=mysql_query("SELECT star_sign FROM sr_star_sign WHERE sign_id = '".$sign_id."'");		if($query){			$result=mysql_fetch_assoc($query);				$star_sign = $result['star_sign'];		}		return $star_sign;	}	/***************SEXUALITY******************/	function getSexuality(){		$array = array();		$query=mysql_query("SELECT * FROM sr_sexuality WHERE status=1");		if($query){			while($result=mysql_fetch_assoc($query)){				$array[] = $result;			}		}		return $array;	}	function getSexualityName($sexuality_id){		$sexuality ='';		$query=mysql_query("SELECT sexuality FROM sr_sexuality WHERE sexuality_id = '".$sexuality_id."'");		if($query){			$result=mysql_fetch_assoc($query);				$sexuality = $result['sexuality'];		}		return $sexuality;	}	/***************BODY TYPE******************/	function getBodyType(){		$array = array();		$query=mysql_query("SELECT * FROM sr_body_type WHERE status=1");		if($query){			while($result=mysql_fetch_assoc($query)){				$array[] = $result;			}		}		return $array;	}	function getBodyTypeName($bodytype_id){		$body_type ='';		$query=mysql_query("SELECT body_type FROM sr_body_type WHERE bodytype_id = '".$bodytype_id."'");		if($query){			$result=mysql_fetch_assoc($query);				$body_type = $result['body_type'];		}		return $body_type;	}	/***************COMPLEXION*****************/	function getComplexion(){		$array = array();		$query=mysql_query("SELECT * FROM sr_complexion WHERE status=1");		if($query){			while($result=mysql_fetch_assoc($query)){				$array[] = $result;			}		}		return $array;	}	function getComplexionName($complexion_id){		$complexion ='';		$query=mysql_query("SELECT complexion FROM sr_complexion WHERE complexion_id = '".$complexion_id."'");		if($query){			$result=mysql_fetch_assoc($query);				$complexion = $result['complexion'];		}		return $complexion;	}	/***************EYE COLOR******************/	function getEyeColor(){		$array = array();		$query=mysql_query("SELECT * FROM sr_eye_color WHERE status=1");		if($query){			while($result=mysql_fetch_assoc($query)){				$array[] = $result;			}		}		return $array;	}	function getEyeColorName($eye_color_id){		$eye_color ='';		$query=mysql_query("SELECT eye_color FROM sr_eye_color WHERE eye_color_id = '".$eye_color_id."'");		if($query){			$result=mysql_fetch_assoc($query);				$eye_color = $result['eye_color'];		}		return $eye_color;	}	/***************HAIR COLOR******************/	function getHairColor(){		$array = array();		$query=mysql_query("SELECT * FROM sr_hair_color WHERE status=1");		if($query){			while($result=mysql_fetch_assoc($query)){				$array[] = $result;			}		}		return $array;	}	function getHairColorName($hair_color_id){		$hair_color ='';		$query=mysql_query("SELECT hair_color FROM sr_hair_color WHERE hair_color_id = '".$hair_color_id."'");		if($query){			$result=mysql_fetch_assoc($query);				$hair_color = $result['hair_color'];		}		return $hair_color;	}	/***************LANGUAGE******************/	function getLanguage(){		$array = array();		$query=mysql_query("SELECT * FROM sr_language WHERE status=1");		if($query){			while($result=mysql_fetch_assoc($query)){				$array[] = $result;			}		}		return $array;	}	function getUserLanguage($user_id){		$array = array();		$query=mysql_query("SELECT * FROM sr_user_language ul,  sr_language l WHERE ul.language_id=l.language_id AND user_id='".$user_id."'");		if($query){			while($result=mysql_fetch_assoc($query)){				$array[] = $result['language_id'];			}		}		return $array;	}	function getLanguageName($language_id){		$language ='';		$query=mysql_query("SELECT language FROM sr_language WHERE language_id = '".$language_id."'");		if($query){			$result=mysql_fetch_assoc($query);				$language = $result['language'];		}		return $language;	}	/******************EDUCATION**************************/	function getEducation(){		$array = array();		$query=mysql_query("SELECT * FROM sr_education WHERE status=1");		if($query){			while($result=mysql_fetch_assoc($query)){				$array[] = $result;			}		}		return $array;	}	function getEducationName($education_id){		$education ='';		$query=mysql_query("SELECT education FROM sr_education WHERE education_id = '".$education_id."'");		if($query){			$result=mysql_fetch_assoc($query);				$education = $result['education'];		}		return $education;	}	/****************INCOME********************************/	function getIncome(){		$array = array();		$query=mysql_query("SELECT * FROM sr_income WHERE status=1");		if($query){			while($result=mysql_fetch_assoc($query)){				$array[] = $result;			}		}		return $array;	}	function getIncomeName($income_id){		$income ='';		$query=mysql_query("SELECT income FROM sr_income WHERE income_id = '".$income_id."'");		if($query){			$result=mysql_fetch_assoc($query);				$income = $result['income'];		}		return $income;	}		function getProfileImage($profile_image){		if (file_exists("upload/photo/".$profile_image)) {			return "upload/photo/200X200/".$profile_image;		}		else if ($profile_image == '' || $profile_image == NULL) {			return "upload/profile_images/dummy-profile.png";		}		else{			return "upload/photo/".$profile_image;		}	}		function getCropProfileImage($profile_image){		if($profile_image != ''){			$query=mysql_query('select photo from sr_user_photo where 				user_id='.$_SESSION['user_id'].' ');			if(mysql_num_rows($query) > 0) {				$res = mysql_fetch_array($query);				$profile_image = $res['photo'];				return "upload/photo/".$profile_image;				if(file_exists("upload/photo/".$profile_image)) {					return "upload/photo/200X200/".$profile_image;				}				else{					return "upload/photo/200X200/".$profile_image;				}			}		}		else {			return "upload/profile_images/dummy-profile.png";		}	}	function getProfileImg($profile_image){		if($profile_image != ''){			$query=mysql_query('select photo, status from sr_user_photo 				where user_id='.$_SESSION['user_id'].' and is_profileImage = 1 ');			if(mysql_num_rows($query) > 0) {				$res = mysql_fetch_array($query);				return $res;			}		}		/*else {			return SITEURL."upload/profile_images/dummy-profile.png";		}*/	}		function getPhotoPath($photo){		if(file_exists("upload/photo/".$photo) && ($photo!='') )        {            return "upload/photo/$photo";        }		else{			//return '';			return 'upload/profile_images/dummy-profile.png';		}	}		function getPhotoThumbPath($photo){		if(file_exists("upload/photo/".$photo) && ($photo!='') ) {			return "upload/photo/thumb/$photo";			//return SITEURL."upload/photo/thumb/$photo"; // updates by Chitra 06/May/2017		}else{			//return '';			return 'upload/profile_images/dummy-profile.png';		}	}	function getThumbPhotoPath($photo){		if(file_exists("upload/photo/".$photo) && ($photo!='') ) {			return "upload/photo/200X200/$photo";			//return SITEURL."upload/photo/thumb/$photo"; // updates by Chitra 06/May/2017		}else{			//return '';			return 'upload/profile_images/dummy-profile.png';		}	}		function vipExpireDate($user_id){		$expireDate = '';		$query=mysql_query("SELECT end_date FROM sr_vip_user WHERE user_id ='".$user_id."' AND status=1 AND DATE(start_date) <'".DATE_TIME."' AND DATE(end_date) >='".DATE_TIME."'");		if($query && mysql_num_rows($query) > 0){			$result = mysql_fetch_assoc($query);			$expireDate = date('d-F-Y' , strtotime($result['end_date']));		}				return $expireDate;			}	function vipChargeAmount($user_id)    {        $amount='';        $query = mysql_query("select * from sr_vip_transaction_history where user_id = ". $_SESSION['user_id']);        if($query && mysql_num_rows($query) > 0){            $result = mysql_fetch_assoc($query);            $amount = $result['amount'];        }        return $amount;    }    function getVipDetails($user_id)    {        $query = mysql_query("select * from sr_vip_transaction_history where user_id = ". $_SESSION['user_id']);        if($query && mysql_num_rows($query) > 0){            $result = mysql_fetch_assoc($query);    //        $amount = $result['amount'];        }        return $result;    }    function getAdminApprovedUser($user_id)    {        $query = mysql_query("select * from sr_vip_user where user_id = ".$user_id);        if($query && mysql_num_rows($query) > 0)        {            $result = mysql_fetch_assoc($query);        }        return $result['by_admin'];    }	function isCreditTopup($user_id){		$query=mysql_query("SELECT auto_topup as auto_topup FROM sr_users WHERE user_id ='".$user_id."' AND is_suspended = 0");		if($query){			return mysql_fetch_assoc($query);		}else {			return 0;		}	}	function isVipMember($user_id){		$query=mysql_query("SELECT id FROM sr_vip_user WHERE user_id ='".$user_id."' AND status=1 AND DATE(start_date) <'".DATE_TIME."' AND DATE(end_date) >='".DATE_TIME."'");		if($query){			return mysql_num_rows($query);		}else {			return 0;		}	}	function isFbLinked($user_id){		$query=mysql_query("SELECT user_id FROM sr_user_login WHERE user_id ='".$user_id."' 			AND oauth_provider='facebook'");		if($query){			return mysql_num_rows($query);		}else {			return 0;		}	}	function isMobileVerified($user_id){		$query=mysql_query("SELECT user_id FROM sr_users WHERE user_id ='".$user_id."' AND is_mobileVerified='1'");		if($query){			return mysql_num_rows($query);		}else {			return 0;		}	}	function isUserVerified($user_id){		$isUserVerified = 0;		$isVipMember = $this->isVipMember($user_id);		$isFbLinked = $this->isFbLinked($user_id);		$isMobileVerified = $this->isMobileVerified($user_id);				if($isVipMember || $isFbLinked || $isMobileVerified){			$isUserVerified = 1;		}			return $isUserVerified;	}		function isRandomUser($added_uid , $user_id){		$query=mysql_query("SELECT * FROM sr_inbox_user WHERE user_id='".$user_id."' AND added_uid='".$added_uid."'");		if($query){			return mysql_num_rows($query);		}else {			return 0;		}	}	/****************************MESSAGE***************************/	function getUnreadMsgCount($user_id){		$query=mysql_query("SELECT count(msg_id) as msg_count FROM sr_user_message WHERE sent_to ='".$user_id."' AND is_read=0");		if($query){			$result=mysql_fetch_assoc($query);			$msg_count=$result['msg_count'];			return $msg_count;		}else {			return 0;		}	}	function isProfileImage($user_id){		echo $query=("SELECT u.profile_image, p.status FROM sr_users u JOIN sr_user_photo p on p.user_id = u.user_id  		WHERE u.user_id ='".$user_id."' AND p.status = 1 AND p.photo = u.profile_image");		if($query){			$result=mysql_fetch_assoc($query);			$profile_image=$result['profile_image'];			if($profile_image != ''){				return 1;			}else {				return 0;			}		}else {			return 0;		}	}	function isUserImage($user_id){		$count=0;		$query=mysql_query("SELECT photo_id FROM sr_user_photo WHERE user_id ='".$user_id."'");		if($query){			$count = mysql_num_rows($query);		}		return $count;	}	/****************************KISMAT CONNECTION********************************************/	function isKcUserLike($user_id , $liked_by){		$query=mysql_query("SELECT status FROM `sr_user_like` WHERE user_id='".$user_id."' and liked_by = '".$liked_by."' AND from_kc=1"); 		if($query){			if(mysql_num_rows($query)){				$result=mysql_fetch_assoc($query);				return $result['status'];			}else {				return 2;			}		}else {			return 3;		}	}	/****************************LIKE********************************************/	/*function isUserLike($user_id , $liked_by){		$query=mysql_query("SELECT status FROM `sr_user_like` WHERE user_id='".$user_id."' and liked_by = '".$liked_by."'"); 		if($query){			if(mysql_num_rows($query)){				$result=mysql_fetch_assoc($query);				return $result['status'];			}else {				return 2;			}		}else {			return 3;		}	}*/	function isUserLike($user_id , $liked_by){		$islike='';		$query=mysql_query("SELECT status FROM `sr_user_like` WHERE user_id='".$user_id."' AND liked_by = '".$liked_by."'"); 		if($query){			if(mysql_num_rows($query)){				$result=mysql_fetch_assoc($query);				$islike = $result['status'];			}		}		return $islike;	}	function userLikeCount($user_id){		$query = mysql_query("SELECT count(like_id) as like_count FROM `sr_user_like` WHERE user_id='".$user_id."' AND status='1' " ); 		if($query){			$result=mysql_fetch_object($query);			$like_count=$result->like_count;			return $like_count;		}else {			return 0;		}	}	function getLikeMe($user_id){		$array = array();		$query=mysql_query("SELECT u.user_id , u.user_name , u.profile_image ,u.dob ,u.location , u.gender ,u.is_online, l.liked_on FROM sr_user_like l , sr_users u WHERE u.user_id = l.liked_by AND l.user_id='".$user_id."' AND status=1 AND liked_by NOT IN(SELECT user_id FROM sr_user_like WHERE liked_by='".$user_id."' AND status=0) ORDER BY l.liked_on DESC ");		if($query){			while($result=mysql_fetch_assoc($query)){				$array[] = $result;			}		}		return $array;	}			/****************************PROFILE VISITOR***************************/	function getProfileVisitor( $user_id )	{		//echo "SELECT u.user_id , u.user_name , u.profile_image ,u.dob ,u.location , u.gender , v.updated_on FROM sr_profile_visitors v , sr_users u WHERE u.user_id = v.visitor_id AND v.user_id='".$user_id."' AND v.visitor_id !='".$user_id."' AND v.status=1 AND u.hide_presence='0' ORDER BY v.updated_on DESC ";		$array = array();		$query = mysql_query("SELECT u.user_id , u.user_name , u.profile_image ,u.dob ,u.location , u.gender ,v.visited_on,                   v.updated_on FROM sr_profile_visitors v , sr_users u                   WHERE u.user_id = v.visitor_id AND v.user_id='".$user_id."' AND v.visitor_id !='".$user_id."'                   AND v.status=1 AND u.hide_presence='0' ORDER BY v.updated_on DESC ");				if($query)		{			while($result=mysql_fetch_assoc($query))			{				$array[] = $result;			}		}				return $array;	}	function gettodayProfileVisitor( $user_id )	{		$today=date('Y-m-d');		$array = array();	 $qj="SELECT u.user_id ,v.visited_on, u.user_name , u.profile_image ,u.dob ,u.location , u.gender , v.updated_on FROM sr_profile_visitors v , sr_users u WHERE u.user_id = v.visitor_id AND v.user_id='".$user_id."' AND v.visitor_id !='".$user_id."' AND v.status=1 AND u.hide_presence=0 AND DATE(v.visited_on) ='".$today." ' ORDER BY v.updated_on DESC ";		$query = mysql_query($qj) or die(mysql_error());		if($query)		{			//echo mysql_num_rows($query);			//print_r($res=mysql_fetch_assoc($query));			while($result=mysql_fetch_assoc($query))			{				//print_r($result);				$array[] = $result;			}		}		return $array;	}			/***************************FAVORITES********************************/	function getFavoritesCount($user_id, $fav_id){		$array = array();		$myFavoritesQuery=mysql_query("SELECT count(user_id) as favcount FROM  sr_user_favourites 			WHERE favourite_by='".$user_id."' and user_id = '".$fav_id."' ");		return mysql_fetch_assoc($myFavoritesQuery);	}	function getMyFavorites($user_id){		$array = array();		$myFavoritesQuery=mysql_query("SELECT u.user_id,u.user_name,u.profile_image,u.dob,u.gender,		 u.is_online,u.here_to,u.location ,u.created_on , f.favourite_on 		 FROM  sr_user_favourites f, sr_users u WHERE f.user_id=u.user_id 		 AND f.favourite_by='".$user_id."' ORDER BY favourite_on DESC");		if($myFavoritesQuery){			while($myFavoritesResult = mysql_fetch_assoc($myFavoritesQuery)){				$array[] = $myFavoritesResult;			}		}		return $array;	}	function getAddedMeFavorites($user_id){		$array = array();		$myFavoritesQuery=mysql_query("SELECT u.user_id,u.user_name,u.profile_image,u.dob,			u.gender , u.here_to , u.is_online ,u.location ,u.created_on , f.favourite_on 			FROM  sr_user_favourites f, sr_users u WHERE f.favourite_by=u.user_id 			AND f.user_id='".$user_id."' ORDER BY favourite_on DESC Limit 0,5 ");		if($myFavoritesQuery){			while($myFavoritesResult = mysql_fetch_assoc($myFavoritesQuery)){				$array[] = $myFavoritesResult;			}		}		return $array;	}	function getMyFriends($user_id){		$array = array();		$friendQuery=mysql_query("SELECT u.user_id,u.user_name,u.profile_image,u.dob,u.gender , u.here_to , u.is_online ,u.location ,u.created_on , f.date 		FROM sr_user_friends f , sr_users u where f.user_id='".$user_id."' AND f.status=1 AND f.friend_id=u.user_id ORDER BY date DESC");		if($friendQuery){			while($friendResult = mysql_fetch_assoc($friendQuery)){				$array[] = $friendResult;			}		}		return $array;	}	/*************************LEFT SIDE***********************************/	function userFavouriteCount($user_id){		$query=mysql_query("SELECT count(favourite_id) as favourite_count FROM `sr_user_favourites` WHERE favourite_by='".$user_id."' AND status=1"); 		if($query){			$result=mysql_fetch_object($query);			$favourite_count=$result->favourite_count;			return $favourite_count;		}else {			return 0;		}	}	function getRatedMeUser($user_id){		$array=array();		$ratedMeQuery=mysql_query("SELECT p.photo_id , p.photo , u.user_id ,u.user_name , u.profile_image ,u.location , u.dob, r.rating FROM `sr_users` u , sr_user_photo p , sr_photo_rating r where u.user_id=r.rated_by AND r.photo_id=p.photo_id AND p.user_id='".$user_id."' GROUP BY r.rated_by");		if($ratedMeQuery){			while($ratedMeResult = mysql_fetch_assoc($ratedMeQuery)){				$array[] = $ratedMeResult;			}		}		return $array;	}	/********************************************************/	function getCustomizeTheme($theme_id){		$theme_name='';		$query=mysql_query("SELECT theme_name FROM `sr_customize_profile` WHERE theme_id='".$theme_id."'"); 		if(mysql_num_rows($query)){			$result=mysql_fetch_assoc($query);			return $result['theme_name'];		}				return $theme_name;	}	function getAllCustomizeTheme(){		$themeArray=array();		$themeQuery=mysql_query("SELECT * FROM `sr_customize_profile` where status=1");		while($themeResult=mysql_fetch_assoc($themeQuery)){			$themeArray[]=$themeResult;		}		return $themeArray;	}	/****************************************************************************/	function isUserFavorite($user_id , $favourite_by){		$query=mysql_query("SELECT status FROM `sr_user_favourites` WHERE user_id='".$user_id."' and favourite_by = '".$favourite_by."' and status=1"); 		if($query){			return mysql_num_rows($query);		}else {			return 0;		}	}	function getStatusIconHtml($user_id ='' , $gender ,$reputation , $isUserFavorite , $isVipMember){		$userNou = '';		$userPer = '';		$statusIconHtml = '';		$userFavorite = '';		$userReputation = '';		$vipMember = '';		if($gender == 1){			$userNou = 'he';			$userPer = 'His';		}if($gender == 2){			$userNou = 'She';			$userPer = 'Her';		}		if($reputation == 'Very Hot'){			$userReputation = '<li><a href="javascript:void(0);" style="cursor:default;" data-toggle="tooltip" data-placement="bottom"  title="'.$userPer.' Reputation is '.$reputation.'!" ><img src="images/icon001.png"/></a></li>';		}		if($isUserFavorite){			$userFavorite = '<li id="favIconImage"><a href="javascript:void(0);" style="cursor:default;" data-toggle="tooltip" data-placement="bottom"  title="Added to Favorites!"><img src="images/star.png"/></a></li>';		}		if($isVipMember){			$vipMember = '<li><a href="javascript:void(0;)" style="cursor:default;"><img src="images/down-arw-red.png" data-toggle="tooltip" data-placement="bottom"  title="VIP Member" style="vertical-align:baseline;"/></a></li>';		}		$promotedProfile=$this->getProfilePromotedDate($user_id);		$statusIconHtml = $userReputation.$userFavorite.$promotedProfile.$vipMember.'';					return $statusIconHtml;	}		function getUserActionHtml($user_id ,$user_name , $isUserFavorite, $page=''){		$actionIconHtml ='';		$favHtml ='';				if($isUserFavorite == 0){			$favHtml = '<a href="javascript:void(0);" class="chkfav add_favourite" id="favourite-'.$user_id.'-'.$user_name.'" data="0">							<span class="mf"></span> Add to Favourites						</a>';		 } else if($isUserFavorite == 1){				$favHtml= '<a href="javascript:void(0);" class="chkfav remove_favourite" id="favourite-'.$user_id.'-'.$user_name.'" data="1">							<span class="mf"></span> Added to Favourites						</a>';		}		//echo $favHtml;		$isUserBlocked = $this->isBlockUser($user_id , $_SESSION['user_id']);		//echo $isUserFavorite."------ Blocked id ---- ".$isUserBlocked." ------- ".$user_id;//die;		if($isUserBlocked){			$actionIconHtml .='<li class="message_now" id="message_now1-'.$user_id.'">								<a href="user-message.php" onclick="location.href = \'user-message.php?chat_id='.$user_id.'\';">									<span class="msg"></span> Message Now								</a>							</li>							<li> 								<a href="javascript:void(0);" class="unblockUser" id="unblockUserMsg2-'.$user_id.'-'.$user_name.'">								<span class="report"></span>Unblock								</a>							</li>';			if($page == "my-favorites"){				$actionIconHtml .='<li>									<a href="javascript:void(0);" class="deleteFav" id="deleteFav-'.$user_id.'">									<span class="dlt"></span>Delete</a>								</li>';			}		}else{			$actionIconHtml .='<li class="message_now" id="message_now1-'.$user_id.'">							<a href="user-message.php" onclick="location.href = \'user-message.php?chat_id='.$user_id.'\';">								<span class="msg"></span> Message Now							</a>							</li>							<li>'.$favHtml.'</li>							<li> 								<a href="javascript:void(0);" class="giveGiftToUser" id="giveGiftToUser1-'.$user_id.'">									<span class="gift"></span>Give Gift								</a>							</li>							<li>								<a href="javascript:void(0);" class="add_block" id="add_block1-'.$user_id.'-'.$user_name.'">									<span class="blk"></span>Block								</a>							</li>							<li> 								<a href="javascript:void(0);" class="reportUser" id="reportUser1-'.$user_id.'">									<span class="report"></span>Report Abuse 								</a>							</li>';			}		return $actionIconHtml;	}		/*********************INTEREST*******************************************/	function getUserInterest($user_id){		$query=mysql_query("SELECT ui.user_interest_id ,i.interest_id ,i.icon , i.interest FROM 		`sr_user_interest` ui , sr_interest i WHERE ui.interest_id=i.interest_id AND ui.user_id='".$user_id."' and i.status = 1 ORDER BY  created_on DESC"); 		return $query;	}	function getUserInterestCount($user_id){		$count = 0;		$query=mysql_query("SELECT ui.user_interest_id FROM `sr_user_interest` ui , sr_interest i WHERE ui.interest_id=i.interest_id AND ui.user_id='".$user_id."' ORDER BY  created_on DESC"); 		if($query){			$count = mysql_num_rows($query);		}		return $count;	}	function getInterestIds($user_id){		$interestArray = array();		$query=mysql_query("SELECT interest_id  FROM `sr_user_interest` WHERE user_id='".$user_id."' ORDER BY  created_on DESC"); 		if($query){			while($result= mysql_fetch_assoc($query)){				$interestArray[] = $result['interest_id'];			}		}		return $interestArray;	}	function getCommonInterest($user_id1 , $user_id2){		$interestData ='';		$intCount = 1;		$interestArray1 = $this->getInterestIds($user_id1);		$interestArray2 = $this->getInterestIds($user_id2);				$intersectArray=array_intersect($interestArray1 , $interestArray2);		$interestArray=array_unique(array_merge($intersectArray , $interestArray2));		$commonInterestCount=count($intersectArray);		$totalInterestCount=count($interestArray);				foreach($interestArray as $interest_id){			if($intCount <= $commonInterestCount) $class='blue'; else $class='';			$interestQuery = mysql_query("SELECT * FROM sr_interest WHERE interest_id='".$interest_id."'");			$interestResult = mysql_fetch_assoc($interestQuery);						$interestData .= "<li>";			$interestData .= "<a class=".$class." href='javascript:void(0);' style='cursor:text;'>";			$interestData .= "<span class=".$interestResult['icon']."></span>";			$interestData .= "<p>".$interestResult['interest']."</p>";			$interestData .= "</a></li>";					if($intCount >= 4) break;			$intCount++;		}  		if($totalInterestCount > 4){			$interestData .= "<li><a href='javascript:void(0);'style='cursor:default;'><span class='more'></span><p>".($totalInterestCount-4)."</p></a></li>";		}				return $interestData;	}		## Finding common Interest	function getMsgCommonInterest($user_id1 , $user_id2)	{		$interestData ='';		$intCount = 1;		$interestArray1 = $this->getInterestIds($user_id1);		$interestArray2 = $this->getInterestIds($user_id2);				$intersectArray = array_intersect($interestArray1 , $interestArray2);		$interestArray = array_unique(array_merge($intersectArray , $interestArray2));		$commonInterestCount = count($intersectArray);		$totalInterestCount = count($interestArray);				foreach( $interestArray as $interest_id )		{			if($intCount <= $commonInterestCount) $class='blue'; else $class='';			$interestQuery = mysql_query("SELECT * FROM sr_interest WHERE interest_id='".$interest_id."'");			$interestResult = mysql_fetch_assoc($interestQuery);						$interestData .= "<li>";			$interestData .= "<img src='images/interest/".$interestResult['icon'].".png' />";			$interestData .= $interestResult['interest'];			$interestData .= "</li>";					if($intCount >= 4) break;			$intCount++;		}  		if($totalInterestCount > 4){			$interestData .= "<li><a href='javascript:void(0);' data-toggle='modal' data-target='#msg_interest_list'><span class='more'></span>".($totalInterestCount-4)."</a></li>";		}				return $interestData;	}			function getInterest($user_id){		$query=mysql_query("SELECT * FROM `sr_interest` WHERE status=1"); 		return $query;	}	function getUserCommonInterest($user_id1 , $user_id2){		$query=mysql_query("SELECT count(interest_id) as interest_count FROM `sr_user_interest` WHERE user_id='".$user_id1."'  AND interest_id  IN(SELECT interest_id  FROM `sr_user_interest` WHERE user_id='".$user_id2."') "); 		if($query){			$result=mysql_fetch_object($query);			$interest_count=$result->interest_count;			return $interest_count;		}else {			return 0;		}	}	/*************************************************/	function getFriends(){		$query=mysql_query("SELECT * FROM `sr_users`"); 		return $query;	}	/*******************88REPUTATION********************/	function getUserReputation($user_id){		//echo "SELECT sum(reputation) as total_reputation FROM `sr_user_reputation` WHERE user_id='".$user_id."' AND status=1";		$query=mysql_query("SELECT sum(reputation) as total_reputation FROM `sr_user_reputation` WHERE user_id='".$user_id."' AND status=1");		if(mysql_num_rows($query)){			$result=mysql_fetch_object($query);			return $result->total_reputation;		}else {			return 0;		}	}	function getUserReputationText($user_id){		$response = $this->getUserReputation($user_id);		if($response <= 40 ) $reputaion='Low';		if($response > 40 && $response <= 60) $reputaion='Heating Up';		if($response > 60 && $response <= 80) $reputaion='Hot';		if($response > 80) $reputaion='Very Hot';				return $reputaion;	}		/******************STICKERS**************************	function getUserStickers($user_id){		$sickerQuery =mysql_query("SELECT s.sticker_title , s.sticker_text , s.sticker_icon , us.* FROM sr_user_sticker us , sr_stickers s WHERE us.sticker_id = s.sticker_id AND us.user_id = '".$user_id."' AND s.status = 1");		if($sickerQuery) {			return $sickerQuery;		}else {			return 0;		}	}	/******************CREDIT**************************/	function getUserCredit($user_id){		$credit = 0;		$query = mysql_query("SELECT * FROM `sr_user_credit` WHERE user_id = '".$user_id."' AND expired_credit = 0 AND (credit)*1 > (used_credit)*1 ORDER BY credited_on");		if($query){			while($result = mysql_fetch_assoc($query)){				$credit += ($result['credit'] - $result['used_credit']);			}		}		return $credit;	}	/******************REWARD**************************/	function insertReward($user_id , $reward_id){		$query = mysql_query("SELECT * FROM  `sr_user_reward` WHERE reward_id = '".$reward_id."' 			AND user_id = '".$user_id."' AND DATE(awarded_on) = DATE('".DATE_TIME."')");		if($query){			if(mysql_num_rows($query) == 0){				$updateQuery = mysql_query("UPDATE sr_user_reward SET is_latest=0 WHERE 					reward_id = '".$reward_id."' AND user_id = '".$user_id."' ");				$insertQuery = mysql_query("INSERT INTO `sr_user_reward` SET 					reward_id = '".$reward_id."' , 					user_id = '".$user_id."' , awarded_on ='".DATE_TIME."' , is_latest='1' ");				if($insertQuery){					mysql_query("INSERT INTO sr_user_credit SET  credit=20, 						used_credit=0, expired_credit=0,status=0,credited_on='".DATE_TIME."', 						user_id='".$user_id."' ");				}			}		}	}	function getUserRewards($user_id){		$array = array();		$rewardQuery =mysql_query("SELECT r.reward_title, r.reward_text, r.reward_desc, r.reward_icon , ur.* FROM sr_user_reward ur , sr_rewards r WHERE ur.reward_id = r.reward_id AND ur.user_id = '".$user_id."' AND is_latest=1 AND r.status = 1 GROUP BY r.reward_id");		if($rewardQuery) {			if(mysql_num_rows($rewardQuery)){				while($rewardResult=mysql_fetch_assoc($rewardQuery)){					$array[] = $rewardResult;				}			}		}		return $array;	}		function getTodayLikeCount($user_id){		$count = 0;		$query =mysql_query("SELECT like_id FROM  `sr_user_like` WHERE  liked_by='".$user_id."' AND DATE( liked_on ) = DATE('".DATE_TIME."')");		if($query) {			$count  = mysql_num_rows($query);		}		return $count;	}	function getTodayPhotoRateCount($user_id){		$count = 0;		$query = mysql_query("SELECT rating_id FROM  `sr_photo_rating` WHERE  rated_by='".$user_id."' AND DATE( updated_on ) = DATE('".DATE_TIME."')");		if($query) {			$count  = mysql_num_rows($query);		}		return $count;	}	function getTodayMessageCount($user_id){		$count = 0;		$query = mysql_query("SELECT msg_id FROM  `sr_user_message` WHERE  	sent_by='".$user_id."' AND DATE(sent_date) = DATE('".DATE_TIME."') GROUP BY sent_to");		if($query) {			$count  = mysql_num_rows($query);		}		return $count;	}	function getTodayRewardCount($user_id){		$count = 0;		$query = mysql_query("SELECT * FROM  `sr_user_reward` WHERE  reward_id=5 AND DATE(awarded_on) = DATE('".DATE_TIME."') AND user_id='".$user_id."'");		if($query) {			$count  = mysql_num_rows($query);		}		return $count;	}	function getTodayProfileVisitorCount($user_id){		$count = 0;		$query =mysql_query("SELECT visit_id FROM `sr_profile_visitors` WHERE user_id='".$user_id."' AND DATE(`updated_on`) = DATE('".DATE_TIME."')");		if($query) {			$count  = mysql_num_rows($query);		}		return $count;	}	function getTodayProfileVisitCount($user_id){		$count = 0;		//echo "SELECT visit_id FROM `sr_profile_visitors` WHERE visitor_id='".$user_id."' AND DATE(`updated_on`) = DATE('".DATE_TIME."')";		$query =mysql_query("SELECT visit_id FROM `sr_profile_visitors` WHERE visitor_id='".$user_id."' AND DATE(`updated_on`) = DATE('".DATE_TIME."')");		if($query) {			$count  = mysql_num_rows($query);		}		return $count;	}	function getTodayVisitorCount($user_id){		$count = 0;		$query =mysql_query("SELECT visit_id FROM `sr_profile_visitors` WHERE user_id='".$user_id."' AND DATE(`updated_on`) = DATE('".DATE_TIME."')");		if($query) {			$count  = mysql_num_rows($query);		}		return $count;	}	function getMonthVisitorCount($user_id){		$visitorQuery =mysql_query("SELECT * FROM `sr_profile_visitors` WHERE user_id='".$user_id."' AND `updated_on` >= '".DATE_TIME."' - INTERVAL 1 MONTH");		if($visitorQuery) {			return mysql_num_rows($visitorQuery);		}else {			return 0;		}	}		/**************UPLOAD PROFILE PHOTO AND PHOTOS***************/	function uploadprofileImage(){		if(isset($_FILES["profile_image"]["name"],$_SESSION['user_id']) and !empty($_FILES["profile_image"]["name"]) and !empty($_SESSION['user_id']))		{            $user_id = $_SESSION['user_id'];                    $photoquery ='';            $dir_name = "upload/photo";			if(!file_exists($dir_name))			{                $flag = mkdir($dir_name, 0777,true);                    			}            if($_FILES["profile_image"]["name"]!='')			{                $fsize = $_FILES["profile_image"]["size"];                             if($fsize> TENMB)				{                    return 7; //file is greater then 2 MB                }                                 $filename = explode(".",$_FILES["profile_image"]["name"]);                $file_ext =  strtolower(end($filename));				$imgname = substr($_FILES["profile_image"]["name"],0,-(strlen($file_ext)+1));                $filename = str_replace(" ","_",$imgname);                                $allExtarray = array("jpg","jpeg","png","gif");                if(!in_array($file_ext,$allExtarray))				{                                    return 8; //file extension not accepted                }      				$profile_image = time().'_'.$filename.'.'.$file_ext;                if(!file_exists($dir_name))                {                    $flag = mkdir($dir_name, 0777,true);                                    }                if(file_exists($dir_name."/".$profile_image))                {                                        @unlink($dir_name."/".$profile_image);                }                $movefile=move_uploaded_file($_FILES["profile_image"]["tmp_name"],$dir_name."/".$profile_image);                if($movefile)				{					mysql_query("UPDATE sr_user_photo SET is_profileImage= 0 WHERE 						is_profileImage=1 and user_id='".$user_id."'");					$query = mysql_query("insert into sr_user_photo set photo='".$profile_image."', 						user_id='".$user_id."',status='0', photo_type='1',private='0',is_profileImage= 1 , 						created_on='".DATE_TIME."',updated_on='".DATE_TIME."',created_by='".$user_id."',						updated_by='".$user_id."'");					$sql=mysql_query("UPDATE sr_users set profile_image='".$profile_image."',						updated_on='".DATE_TIME."' WHERE user_id='".$user_id."'");										if($query==true && $sql==true)					{						return 1; //#####  ADDED SUCCESS					}					else					{						 return 0; //#####  FAILED SQL ERROR					}                }else {					return 4; //cant move				}            }	    }		else		{            return 3;  //##### REQUIRED PARAMETER MISSING        }	}		function uploadPhoto($type=1){		//type = 1 => photos of you		//type = 2 => group photos		//type = 3 => private photos 		if(count($_FILES["upload_photo"]["name"]))        {            $user_id = $_SESSION['user_id'];                    $photoquery ='';            $dir_name = "upload/photo";			//changes by Chitra on 05 May 2017			$thumbdir = "upload/photo/thumb";			$thumbdir200x200 = "upload/photo/200X200";			if(!file_exists($dir_name))			{                $flag = mkdir($dir_name, 0777,true);                    			}			//changes by Chitra on 05 May 2017			if(!file_exists($thumbdir)){				$tflag = mkdir($thumbdir, 0777, true);			}			if(!file_exists($thumbdir200x200)){				$tmflag = mkdir($thumbdir200x200, 0777, true);			}						for($i=0 ; $i< count($_FILES["upload_photo"]["name"]); $i++){				//$extension = $_FILES["upload_photo"]["name"][$i];								if($_FILES["upload_photo"]["name"][$i] !='')				{					$fsize = $_FILES["upload_photo"]["size"][$i];             					if($fsize <= TENMB)					{						$filename = explode(".",$_FILES["upload_photo"]["name"][$i]);						$file_ext =  strtolower(end($filename));						$imgname = substr($_FILES["upload_photo"]["name"][$i],0,-(strlen($file_ext)+1));						$filename = str_replace(" ","_",$imgname);                						$allExtarray = array("jpg","jpeg","png");						if(in_array($file_ext,$allExtarray))						{							$upload_photo = time().'_'.$filename.'.'.$file_ext;							if(file_exists($dir_name."/".$upload_photo))							{                    								@unlink($dir_name."/".$upload_photo);							}							//$movefile=move_uploaded_file($_FILES["upload_photo"]["tmp_name"][$i],$dir_name."/".$upload_photo);							//Changes made by Chitra on 05 May 2017							$movefile = move_uploaded_file($_FILES["upload_photo"]["tmp_name"][$i],$dir_name."/".$upload_photo);							// Resize image to thumb:							// *** 1) Initialise / load image							$resizeObj = new resize($dir_name."/".$upload_photo);							// *** 2) Resize image (options: exact, portrait, landscape, auto, crop)							//echo $thumbdir;							$resizeObj -> resizeImage(387, 387, 'auto');                            $resizeObj -> resizeImage(150, 150, 'crop');							$resizeObj -> saveImage($thumbdir.'/'.$upload_photo, 100);							//echo 'resized';die;							$resizeObj -> resizeImage(200, 200, 'auto');                            $resizeObj -> resizeImage(150, 150, 'crop');							$resizeObj -> saveImage($thumbdir200x200.'/'.$upload_photo, 100);														/*$resizeObj -> resizeImage(280, 174, 'exact');							$resizeObj -> saveImage('../gallery_280x174/'.$extension, 100);*/														if($movefile)							{								if($type == 1)								{									$chkProfilePic = mysql_query("Select photo_id from sr_user_photo where 										is_profileImage = '1' and created_by = '".$user_id."' ");									$isProfileImg = 0;									if( mysql_num_rows($chkProfilePic)<1 )									{										$sql=mysql_query("UPDATE sr_users set profile_image='".$upload_photo."', 											updated_on='".DATE_TIME."' WHERE user_id='".$user_id."'");										$isProfileImg = 1;									}																		$query = mysql_query("insert into sr_user_photo set 									photo='".$upload_photo."', user_id='".$user_id."', 									status='0', is_profileImage = '".$isProfileImg."', 									filepath = '".$dir_name."', thumbfilepath = '".$thumbdir."',									thumbfilepath200x200 = '".$thumbdir200x200."',									photo_type='1', private='0', created_on='".DATE_TIME."', 									updated_on='".DATE_TIME."', created_by='".$user_id."', 									updated_by='".$user_id."' "); 									/* $query = mysql_query("insert into sr_user_photo set photo='".$upload_photo."', user_id='".$user_id."',status='0', photo_type='1',private='0',created_on='".DATE_TIME."',updated_on='".DATE_TIME."',created_by='".$user_id."',updated_by='".$user_id."'"); */ 								}								if($type == 2){									$query = mysql_query("insert into sr_user_photo set 										photo='".$upload_photo."', user_id='".$user_id."',status='0', 										photo_type='2',private='0',created_on='".DATE_TIME."',										updated_on='".DATE_TIME."',created_by='".$user_id."',										updated_by='".$user_id."'"); 								}								if($type == 3){									$query = mysql_query("insert into sr_user_photo set 										photo='".$upload_photo."', user_id='".$user_id."',status='0', 										photo_type='0',private='1',created_on='".DATE_TIME."',										updated_on='".DATE_TIME."',created_by='".$user_id."',										updated_by='".$user_id."'"); 								}								if($query==true)								{									//return 1; //#####  ADDED SUCCESS									$err_msg = 'SUCCESS';								}								else								{									//return 0; //#####  FAILED SQL ERROR									$err_msg = 'FAILED SQL ERROR';								}							}else{								//return 9;								$err_msg = 'FAILED UPLOAD';							}						}else{							//return 8; //file extension not accepted							$err_msg = 'File extension not accepted';						}     					}else{						//return 7; //file is greater then 2 MB						$err_msg = 'File is greater then 2 MB';					}                 				} //not blank			}//FOR LOOP			return 1;	    }		else		{            return 3;  //##### REQUIRED PARAMETER MISSING        }	}			/**********************PHOTOS*******************************/	function getAllPhotosCount(){		$query=mysql_query("SELECT * FROM `sr_user_photo` WHERE private=0 AND status = 1"); 		if($query){			return mysql_num_rows($query);		}else {			return 0;		}	}	function getUserPhoto($user_id){		$query=mysql_query("SELECT * FROM `sr_user_photo` WHERE user_id='".$user_id."' AND private=0 AND status = 1 ORDER BY `is_profileImage` DESC"); 		return $query;	}	function getPublicPhotoCount($user_id){		$query=mysql_query("SELECT * FROM `sr_user_photo` WHERE user_id='".$user_id."' AND private=0 AND status=1"); 		if($query){			return mysql_num_rows($query);		}else {			return 0;		}	}	function getPrivatePhotoCount($user_id){		$query=mysql_query("SELECT * FROM `sr_user_photo` WHERE user_id='".$user_id."' AND private=1 AND status=1"); 		if($query){			return mysql_num_rows($query);		}else {			return 0;		}	}	function getMyPhotoCount($user_id){		$query=mysql_query("SELECT * FROM `sr_user_photo` WHERE user_id='".$user_id."' 			AND photo_type=1 AND private = 0 AND status=1");		if($query){			return mysql_num_rows($query);		}else {			return 0;		}	}	function getMyPhotoCountUser($user_id){		$query=mysql_query("SELECT * FROM `sr_user_photo` WHERE user_id='".$user_id."' 			AND photo_type=1 AND private = 0 and status != 2");		if($query){			return mysql_num_rows($query);		}else {			return 0;		}	}	function getMyPhotoCountKC($user_id){		$query=mysql_query("SELECT * FROM `sr_user_photo` WHERE user_id='".$user_id."' AND photo_type=1 AND status = 1 AND private = 0");		if($query){			return mysql_num_rows($query);		}else {			return 0;		}	}	function getGroupPhotoCount($user_id){		$query=mysql_query("SELECT * FROM `sr_user_photo` WHERE user_id='".$user_id."' AND photo_type=2 AND private=0 AND status=1"); 		if($query){			return mysql_num_rows($query);		}else {			return 0;		}	}	function getMyphots($user_id){		$query=mysql_query("SELECT * FROM `sr_user_photo` WHERE user_id='".$user_id."' AND photo_type=1 AND status=1 ORDER BY created_on DESC"); 		if($query){			return $query;		}else {			return 0;		}	}			#Get Photos for Score Widget	function getPhotosForScoreWidget($user_id){		$query = mysql_query("SELECT * FROM `sr_user_photo` 		WHERE user_id='".$user_id."' AND photo_type=1 and status<2		ORDER BY created_on DESC"); 		return ($query)?$query:0;	}			function getPhotoAverageRating($p_id){		$ratingQuery=mysql_query("SELECT rating FROM sr_photo_rating WHERE photo_id='".$p_id."'");		$sum=0;		while($ratingResult=mysql_fetch_assoc($ratingQuery)){			$sum=$sum+$ratingResult['rating'];		}		$totalCount=mysql_num_rows($ratingQuery);		if($totalCount > 0){			$average=(($sum)/($totalCount));			return round($average , 1);		}else {			return 0;		}	}	function getAverageRating($user_id){		$sum=0;		$avgPhotoRateQuery=mysql_query("SELECT p.photo_id , r.rating , p.photo FROM sr_user_photo p , sr_photo_rating r where r.photo_id=p.photo_id AND p.user_id='".$user_id."' AND p.status=1");		while($avgPhotoRateResult=mysql_fetch_assoc($avgPhotoRateQuery)){			//$photoArray[] = $avgPhotoRateResult;			$sum=$sum+$avgPhotoRateResult['rating'];		}		$totalCount=mysql_num_rows($avgPhotoRateQuery);		if($totalCount > 0){			$avgRating=round(($sum)/($totalCount));		}else {			$avgRating = 0;		}		return $avgRating;	}		//##########################################COMMENT	function getLastPhotoComment($photo_id){		$commentArray=array();		$photoCommentQuery=mysql_query("SELECT u.user_id,u.user_name,u.profile_image ,c.* FROM sr_photo_comment c,sr_users u WHERE photo_id = '".$photo_id."' AND u.user_id=c.commented_by ORDER BY commented_on DESC LIMIT 0,1");		if($photoCommentQuery){			while($photoCommentResult=mysql_fetch_assoc($photoCommentQuery)){				$commentArray[] = $photoCommentResult;			}		}		return $commentArray;	}	function getLastCommentReply($photo_id , $com_id){		$replyArray=array();		$replyQuery=mysql_query("SELECT u.user_id,u.user_name,u.profile_image ,r.* FROM  sr_comment_reply r,sr_users u WHERE photo_id = '".$photo_id."' AND com_id = '".$com_id."' AND u.user_id=r.reply_by ORDER BY reply_on DESC LIMIT 0,1");		if($replyQuery){			while($replyResult=mysql_fetch_assoc($replyQuery)){				$replyArray[] = $replyResult;			}		}		return $replyArray;	}	function getMyPhotoComment($user_id){		$commArray=array();		//echo "SELECT * FROM `sr_user_photo` WHERE user_id='".$user_id."' AND status=1 AND photo_id IN(SELECT photo_id FROM sr_photo_comment)";		$allMyPhotoQuery=mysql_query("SELECT * FROM `sr_user_photo` WHERE user_id='".$user_id."' AND status=1 AND photo_id IN(SELECT photo_id FROM sr_photo_comment)"); 		if($allMyPhotoQuery){			while($allMyPhotoResult=mysql_fetch_assoc($allMyPhotoQuery)){				$commArray[] = $allMyPhotoResult;			}		}		return $commArray;	}	function getOtherPhotoComment($user_id){		$commArray=array();		$otherPhotoQuery=mysql_query("SELECT * FROM `sr_user_photo` WHERE user_id !='".$user_id."' AND status=1 AND photo_id IN(SELECT photo_id FROM sr_photo_comment where commented_by='".$user_id."')"); 		if($otherPhotoQuery){			while($otherPhotoResult=mysql_fetch_assoc($otherPhotoQuery)){				$commArray[] = $otherPhotoResult;			}		}		return $commArray;	}	function getAllCommentReply($photo_id , $com_id){		$replyArray=array();		$replyQuery=mysql_query("SELECT u.user_id,u.user_name,u.profile_image ,r.* FROM  sr_comment_reply r,sr_users u WHERE photo_id = '".$photo_id."' AND com_id = '".$com_id."' AND u.user_id=r.reply_by ORDER BY reply_on DESC");		if($replyQuery){			while($replyResult=mysql_fetch_assoc($replyQuery)){				$replyArray[] = $replyResult;			}		}		return $replyArray;	}			# GIFT	function getGifts(){		$query=mysql_query('SELECT * FROM sr_gifts WHERE status = 1');		if($query){			return $query;		}else {			return 0;		}	}	function getUserGift($user_id){		$query=mysql_query("SELECT g.gift,u.user_name,ug.gifted_on FROM sr_gifts g ,sr_user_gift ug ,sr_users u WHERE ug.gift_id=g.gift_id AND ug.gifted_by=u.user_id AND g.status = 1 AND ug.user_id='".$user_id."' ORDER BY ug.gifted_on DESC LIMIT 1");		if(mysql_num_rows($query)){			return $query;		}else {			return 0;		}	}	function getGiftByID($giftID = '')	{		$giftArr = array();		$query = mysql_query("Select * from sr_gifts WHERE status = 1 and gift_id = '".$giftID."' ");		if( mysql_num_rows($query)>0 )		{			while( $queryFetch = mysql_fetch_array($query) )			{				$giftArr[] = $queryFetch;			}		}		return $giftArr;	}	//####################################FAME REEL#####################################	function getPhotoReel( $userCity , $userCountry )	{		$user_id = $_SESSION['user_id'];		$userInfo=$this->getUserInfo($user_id);		$lon=$userInfo['location_lon'];		$lat=$userInfo['location_lat'];		$location=$userInfo['location'];		$array = array();           /*echo "SELECT sr_fame_reel.user_id, sr_fame_reel.created_on, sr_user_photo.*, sr_users.user_id, sr_users.user_name,		sr_users.location, sr_users.profile_image , sr_users.dob, sr_users.is_online 		FROM sr_user_photo, sr_fame_reel, sr_users 		where sr_fame_reel.user_id=sr_users.user_id  AND sr_users.location_lat=$lat AND sr_users.location_lon=$lon AND sr_users.is_account_freeze = 0 AND sr_fame_reel.user_id=sr_user_photo.user_id AND sr_user_photo.is_profileImage=1  AND sr_user_photo.status=1   	AND sr_fame_reel.created_on > date_sub(now(), interval 10 minute) ";*/		$query = mysql_query("SELECT sr_fame_reel.user_id, sr_fame_reel.created_on, sr_user_photo.*, sr_users.user_id, sr_users.user_name, 		sr_users.location, sr_users.profile_image , sr_users.dob, sr_users.is_online 		FROM sr_user_photo, sr_fame_reel, sr_users 		where sr_fame_reel.user_id=sr_users.user_id  AND sr_users.location_lat=$lat AND sr_users.location_lon=$lon AND sr_users.is_account_freeze = 0 AND sr_fame_reel.user_id=sr_user_photo.user_id AND sr_user_photo.is_profileImage=1  AND sr_user_photo.status=1   	AND sr_fame_reel.created_on > date_sub(now(), interval 10 minute) ");		$num1=mysql_num_rows($query);		//echo $num1."1st";		if($num1<12)		{                /*echo "SELECT sr_fame_reel.user_id, sr_fame_reel.created_on, sr_user_photo.*, sr_users.user_id, sr_users.user_name, 	sr_users.location, sr_users.profile_image , sr_users.dob, sr_users.is_online			FROM sr_user_photo, sr_fame_reel, sr_users 			where sr_fame_reel.user_id=sr_users.user_id  AND sr_users.location_lat=$lat AND sr_users.location_lon=$lon AND sr_users.is_account_freeze = 0 AND sr_fame_reel.user_id=sr_user_photo.user_id AND sr_user_photo.is_profileImage=1  AND sr_user_photo.status=1 			and sr_users.user_id NOT IN (select user_id from ep_profile) ";*/				$query = mysql_query("SELECT sr_fame_reel.user_id, sr_fame_reel.created_on, sr_user_photo.*, sr_users.user_id, sr_users.user_name, 	sr_users.location, sr_users.profile_image , sr_users.dob, sr_users.is_online 			FROM sr_user_photo, sr_fame_reel, sr_users 			where sr_fame_reel.user_id=sr_users.user_id  AND sr_users.location_lat=$lat AND sr_users.location_lon=$lon AND sr_users.is_account_freeze = 0 AND sr_fame_reel.user_id=sr_user_photo.user_id AND sr_user_photo.is_profileImage=1  AND sr_user_photo.status=1 			and sr_users.user_id NOT IN (select user_id from sr_ep_profile) ");			$num2=mysql_num_rows($query);			//echo $num2."2nd";			if($num2<12)			{				/*echo  "SELECT sr_fame_reel.user_id, sr_fame_reel.created_on, sr_user_photo.*, sr_users.user_id, sr_users.user_name,				sr_users.location, sr_users.profile_image , sr_users.dob,sr_users.is_online 				FROM sr_user_photo, sr_fame_reel, sr_users 				where sr_fame_reel.user_id=sr_users.user_id  AND sr_users.location_lat=$lat AND sr_users.location_lon=$lon AND sr_users.is_account_freeze = 0	AND  sr_fame_reel.user_id=sr_user_photo.user_id AND sr_user_photo.is_profileImage=1 AND sr_user_photo.status=1 ";*/				$query = mysql_query("SELECT sr_fame_reel.user_id, sr_fame_reel.created_on, sr_user_photo.*, sr_users.user_id, sr_users.user_name, 				sr_users.location, sr_users.profile_image , sr_users.dob,sr_users.is_online 				FROM sr_user_photo, sr_fame_reel, sr_users 				where sr_fame_reel.user_id=sr_users.user_id  AND sr_users.location_lat=$lat AND sr_users.location_lon=$lon AND sr_users.is_account_freeze = 0	AND  sr_fame_reel.user_id=sr_user_photo.user_id AND sr_user_photo.is_profileImage=1 AND sr_user_photo.status=1 ");			}		}		if( $query )		{			while( $result = mysql_fetch_array($query) )			{				$array[] = $result;			}			}		return $array;	}	function time2str($ts)	{		//echo $ts;		if(!ctype_digit($ts))			$ts = strtotime($ts);		 $diff = time() - $ts;		if($diff == 0)			return 'just now';		elseif($diff > 0)		{			$day_diff = floor($diff / 86400);			if($day_diff == 0)			{				if($diff < 60) return 'just now';				if($diff < 120) return '1 minute ago';				if($diff < 3600) return floor($diff / 60) . ' minutes ago';				if($diff < 7200) return '1 hour ago';				if($diff < 86400) return floor($diff / 3600) . ' hours ago';			}			if($day_diff == 1) return 'Yesterday';			if($day_diff < 7) return $day_diff . ' days ago';			if($day_diff < 31)				if(ceil($day_diff / 7)==1)return ' 1 week ago';				else return ceil($day_diff / 7) . ' weeks ago';			if($day_diff < 60) return ' last month';			return date('F Y', $ts);		}		else		{			$diff = abs($diff);			$day_diff = floor($diff / 86400);			if($day_diff == 0)			{				if($diff < 120) return 'in a minute';				if($diff < 3600) return 'in ' . floor($diff / 60) . ' minutes';				if($diff < 7200) return 'in an hour';				if($diff < 86400) return 'in ' . floor($diff / 3600) . ' hours';			}			if($day_diff == 1) return 'Tomorrow';			if($day_diff < 4) return date('l', $ts);			if($day_diff < 7 + (7 - date('w'))) return 'next week';			if(ceil($day_diff / 7) < 4) return 'in ' . ceil($day_diff / 7) . ' weeks';			if(date('n', $ts) == date('n') + 1) return 'next month';			return date('F Y', $ts);		}	}		function isFameReel( $user_id )	{		$returnVal = 0;		$query = mysql_query("SELECT * FROM sr_fame_reel WHERE user_id='".$user_id."'");				if( $query )		{			$returnVal = mysql_num_rows($query);		}		return $returnVal;	}			//##################################BLOCK###########################################	function userBlockCount($user_id){		$block_count = 0;		$query=mysql_query("SELECT count(block_id) as block_count FROM `sr_user_block` WHERE block_by='".$user_id."'"); 		if($query){			$result=mysql_fetch_object($query);			$block_count=$result->block_count;			}		return $block_count;	}	function isBlockUser($user_id , $block_by){		$returnVal = 0;		$query=mysql_query("SELECT * FROM sr_user_block WHERE user_id='".$user_id."' AND block_by='".$block_by."'");		if($query){			$returnVal = mysql_num_rows($query);		}		return $returnVal;	}	function isMeBlocked($user_id, $block_by)		{			$returnVal = 0;			$query=mysql_query("SELECT * FROM sr_user_block WHERE user_id='".$block_by."' AND block_by='".$user_id."'");			if($query){				$returnVal = mysql_num_rows($query);			}			return $returnVal;		}	function getBlockMeDetail($user_id,$block_by)	{		$returnVal='';		$query=mysql_query("SELECT * FROM sr_user_block WHERE user_id='".$block_by."' AND block_by='".$user_id."'");		if($query){			$returnVal = mysql_fetch_array($query);		}		return $returnVal;	}	function getBlockUser($user_id){		$array = array();		$query=mysql_query("SELECT  u.user_id,u.user_name,u.profile_image,u.dob,u.gender , u.is_online,u.here_to,u.location ,b.block_on FROM `sr_user_block` b,sr_users u WHERE b.block_by='".$user_id."' AND b.user_id=u.user_id AND b.status=1 ORDER BY b.block_on DESC"); 		if($query){			while($result=mysql_fetch_assoc($query)){				$array[]=$result;			}			}		return $array;	}	function getOnlineUser($user_id){		$array = array();		$userinfo=$this->getUserInfo($user_id);		$userLocation_lat=$userinfo['location_lat'];		$userLocation_lon=$userinfo['location_lon'];		$query=mysql_query("SELECT user_id, user_name, profile_image, dob, gender,is_online,here_to,location,(		   3959 *		   acos(cos(radians($userLocation_lat)) *		   cos(radians(location_lat)) *		   cos(radians(location_lon) -		   radians($userLocation_lon)) +		   sin(radians($userLocation_lat)) *		   sin(radians(location_lat )))		) 		AS distance FROM sr_users WHERE user_id !='".$user_id."' AND is_online=1  HAVING distance < 62");		/*echo "SELECT user_id, user_name, profile_image, dob, gender,is_online,here_to,location,(		   3959 *		   acos(cos(radians($userLocation_lat)) *		   cos(radians(location_lat)) *		   cos(radians(location_lon) -		   radians($userLocation_lon)) +		   sin(radians($userLocation_lat)) *		   sin(radians(location_lat )))		) 		AS distance FROM sr_users WHERE user_id !='".$user_id."' AND is_online=1 		HAVING distance < 62";*/		if($query){			while($result=mysql_fetch_assoc($query)){				$array[]=$result;			}		}		return $array;	}	function getProfilePromotedDate($user_id){		$profilePromotedDate='';		/*$query=mysql_query("SELECT redeem_id,redeem_date FROM sr_user_credit_redeem r , sr_user_credit c WHERE r.credit_id=c.credit_id 		AND r.service=1 and c.user_id='".$user_id."' and DATEDIFF(now(),redeem_date)<=15 ORDER BY  r.redeem_date DESC LIMIT 0 , 1");		if($query && mysql_num_rows($query)){			$result=mysql_fetch_assoc($query);			if($this->getTimeToStr($result['redeem_date']) < '2 weeks ago'){				$profilePromotedDate = '<li class="pull-right"><a href="javascript:void(0);" class="parmot_profile" 				title="Promoted Profile '.$this->getTimeToStr($result['redeem_date']).'"></a></li>';			}		}*/		$query=mysql_query("SELECT redeem_id,redeem_date, DATEDIFF(now(),redeem_date) as diff FROM sr_user_credit_redeem r , sr_user_credit c 		WHERE r.credit_id=c.credit_id AND c.user_id='".$user_id."' ORDER BY  r.redeem_date DESC LIMIT 0 , 1");		if($query && mysql_num_rows($query)){			$result=mysql_fetch_assoc($query);			if($result['diff'] < '15'){				$profilePromotedDate = '<li><a href="javascript:void(0);" class="parmot_profile" title="Promoted Profile '.$this->getTimeToStr($result['redeem_date']).'"></a></li>';			}		}		return $profilePromotedDate;	}	/**********************************************************/	function notifyUser($email_id , $country , $globalDateTime){		$notify_query=mysql_query("SELECT * FROM sr_user_notify where email_id='".$email_id."'");		if(mysql_num_rows($notify_query) == 0){			$query=mysql_query("INSERT INTO sr_user_notify SET email_id='".$email_id."' , country ='".$country."' , datetime='".$globalDateTime."'");			if($query){				return 1;			}else{				return 0;			}		}else{			return 2;		}	}	function checkEmailDuplicate($email_id){		$query=mysql_query("SELECT * FROM sr_user_login where email_id='".$email_id."' 			and (password = '' OR oauth_uid='')");		if(mysql_num_rows($query) > 0){			return 1;		}else{			return 0;		}	}		function checkFbEmailDuplicate($email_id, $oauth_uid){		$query=mysql_query("SELECT * FROM sr_user_login where email_id='".$email_id."' and 	oauth_uid = '".$oauth_uid."'");		if(mysql_num_rows($query) > 0){			return 1;		}else{			return 0;		}	}		#User Registration	function userSignUp( $email_id, $password, $ref_uid, $signupFrom="", $fbArray=array())	{		$verify_code = mt_rand();		if($signupFrom == "facebook"){				//echo "<pre>";print_r($fbArray);			$checkEmail = $this->checkFbEmailDuplicate($email_id,$fbArray['id']);			//echo $checkEmail;exit;			if( $checkEmail)			{				$q = mysql_query("Select sr_user_login.*, sr_users.*					from sr_user_login 					INNER JOIN sr_users on sr_users.user_id = sr_user_login.user_id					where sr_user_login.email_id = '".$email_id."'");				$user_res = mysql_fetch_assoc($q);				$_SESSION['user_id'] = $user_res['user_id'];				$_SESSION['fb_user'] = $fbArray['name'];				$_SESSION['fbgen'] = $fbArray['gender'];				$img = parse_url($fbArray['picture']['url']);				$path = explode('/', $img['path']);				$filename = end($path);				$url = "/home/startrishta/beta-dev/public_html/upload/";				$thumbdir = $url."photo/thumb/";				$dir = $url."photo/";				$dir200 = $url."photo/200X200/";				if($user_res['is_deleted'] != 0 || $user_res['is_suspended'] != 0){					return 3;				}				else if($user_res['is_erase'] != 0 ){					mysql_query("DELETE from  sr_vip_user where user_id = '".$user_res['user_id']."' ");					mysql_query("DELETE from sr_user_friends where user_id = '".$user_res['user_id']."' ");					mysql_query("DELETE from sr_email_notification where user_id = '".$user_res['user_id']."' ");					mysql_query("DELETE from sr_users where user_id = '".$user_res['user_id']."'");					return 2;				}				else{										$targetPath = $dir.$filename;					mysql_query("update sr_users set 						is_verified=1, 						is_online = 1,						updated_on = '".DATE_TIME."'						where user_id = '".$user_res['user_id']."'");					mysql_query("update sr_user_login set 						oauth_provider='facebook',						oauth_uid = '".$fbArray['id']."', 						fb_id = '".$fbArray['id']."', 						updated_on = '".DATE_TIME."'						where user_id = '".$user_res['user_id']."'");										$chkPhoto = mysql_num_rows(mysql_query("select * from sr_user_photo 						where user_id = '".$user_res['user_id']."' 						and photo = '".$filename."' and photo_type=1"));										if($chkPhoto < 1){						if(file_exists("../upload/photo/".$filename)){							unlink("../upload/photo/".$filename);							unlink("../upload/photo/thumb/".$filename);							unlink("../upload/photo/200X200/".$filename);						}/*						mysql_query('INSERT into `sr_user_photo` set						`user_id`='.$user_res['user_id'].', `photo`="'.$filename.'", `caption`="", `status`=1, 						`filepath` = "'.$dir.'", `thumbfilepath` = "'.$thumbdir.'", 						`thumbfilepath200x200` = "'.$dir200.'", `private`=0, `photo_type`=1, 						`rate_status`=0, `is_profileImage`=1, `from_facebook`="1", `created_on`=now(), 						`created_by`=1, `updated_by`=1, `updated_on`=now()');*/					}					return 2;				}			}			else			{								$DateTime = gmdate("Y-m-d H:i:s", time()+19800);				$query = mysql_query("INSERT INTO sr_user_login SET 					email_id = '".$email_id."',					status = '1',					oauth_uid = '".$fbArray['id']."',					oauth_provider='facebook',					verify_code = '".$verify_code."', 					created_on = '".$DateTime."', 					updated_on = '".$DateTime."', 					role_id = 2");              $user_id_fb = mysql_insert_id();				if( $query )				{                    $_SESSION['fb_dp']=$fbArray['image'];                    $_SESSION['user_id']=$user_id_fb;                    $this->sendSignUpMailFB($email_id, $fbArray['name'], $verify_code, "facebook");                    #Update Login Table                    $signInQuery = mysql_query("SELECT * FROM sr_user_login WHERE 						email_id = '".$email_id."' AND verify_code = '".$verify_code."'");                    $signInResult = mysql_fetch_object($signInQuery);                    $_SESSION['user_id'] = $signInResult->user_id;                    $ref_uid = $signInResult->user_id;                    //FOR FREE VIP MEMBERSHIP AND ADD ON FRIEND LIST                    $end_date = date("Y-m-d H:i:s", strtotime("+1 day", strtotime($DateTime)));                    $userQuery = mysql_query("select * from sr_user_login where 							user_id = '".$ref_uid."'");                    if( $userQuery && mysql_num_rows($userQuery)>0 )                    {                        $userData = mysql_fetch_array($userQuery);                        //UPDATE EMAIL ALERT NOTIFICATIONS                        $alert_query = mysql_query("INSERT INTO sr_email_notification SET 								new_message = '1', message_comment='1', profile_visitor='1', 								like_you='1', new_match='1', startrishta_new='1', alert='1', gift='1' , 								favorite_you='1', photo_rating='1', user_id='".$userData['user_id']."', 								created_on='".DATE_TIME."', updated_on='".DATE_TIME."'");                    }                    $_SESSION['fb_user'] = $fbArray['name'];                    $_SESSION['fbgen'] = $fbArray['gender'];                    return 1;				}				else{					return 0;				}			}		}		else{			extract($_POST);			if( $email_id != '' && $password != '' )			{				$checkEmail = $this->checkEmailDuplicate($email_id);				if( $checkEmail )				{					return 2; // email id is already exit				}				else{					//$verify_code = mt_rand();					$DateTime = gmdate("Y-m-d H:i:s", time()+19800);					$query = mysql_query("INSERT INTO sr_user_login SET 						email_id = '".$email_id."' ,password = '".md5($password)."', 						verify_code = '".$verify_code."' , created_on = '".$DateTime."', 						updated_on = '".$DateTime."' , role_id = 2");					if( $query )					{												#Update Login Table						$signInQuery = mysql_query("SELECT * FROM sr_user_login WHERE 							email_id = '".$email_id."' AND password = '".md5($password)."' 							AND verify_code = '".$verify_code."'");						$signInResult = mysql_fetch_object($signInQuery);						$_SESSION['user_id'] = $signInResult->user_id;												//FOR FREE VIP MEMBERSHIP AND ADD ON FRIEND LIST						if( $ref_uid != '' )						{							$end_date = date("Y-m-d H:i:s", strtotime("+1 day", strtotime($DateTime)));							$userQuery = mysql_query("select * from sr_user_login where 								md5(user_id) = '".($ref_uid)."'");							if( $userQuery && mysql_num_rows($userQuery)>0 )							{								$userData = mysql_fetch_array($userQuery);								//FOR FREE VIP MEMBERSHIP								$vipQuery = mysql_query("SELECT * FROM sr_vip_user WHERE 									user_id = '".$userData['user_id']."' and status = 1");																if( $vipQuery && mysql_num_rows($vipQuery) == 0 )								{									$Query = mysql_query("INSERT INTO  sr_vip_user 										SET  vip_id = '0' , user_id = '".$userData['user_id']."', 										start_date = '".$DateTime."' , end_date = '".$end_date."', 										status = 1");								}																//ADD ON FRIEND LIST								$friendQuery = mysql_query("INSERT INTO sr_user_friends 									SET user_id = '".$userData['user_id']."' , 									friend_id = '".$_SESSION['user_id']."' , status = 1 , 									date = '".$DateTime."'");								//UPDATE EMAIL ALERT NOTIFICATIONS								$alert_query = mysql_query("INSERT INTO sr_email_notification SET 									new_message = '1', message_comment='1', profile_visitor='1', 									like_you='1', new_match='1', startrishta_new='1', alert='1', gift='1' , 									favorite_you='1', photo_rating='1', user_id='".$userData['user_id']."', 									created_on='".DATE_TIME."', updated_on='".DATE_TIME."'");							}						}						return 1;					}					else{						return 0;					}				}			}			else{				return 3; // required parameter not exist			}		}	}	function resize_image($file, $w, $h, $crop=true) {	    list($width, $height) = getimagesize($file);	    $r = $width / $height;	    if ($crop) {	        if ($width > $height) {	            $width = ceil($width-($width*abs($r-$w/$h)));	        } else {	            $height = ceil($height-($height*abs($r-$w/$h)));	        }	        $newwidth = $w;	        $newheight = $h;	    } else {	        if ($w/$h > $r) {	            $newwidth = $h*$r;	            $newheight = $h;	        } else {	            $newheight = $w/$r;	            $newwidth = $w;	        }	    }	    $src = imagecreatefromjpeg($file);	    $dst = imagecreatetruecolor($newwidth, $newheight);	    imagecopyresampled($dst, $src, 0, 0, 0, 0, $newwidth, $newheight, $width, $height);	    return $dst;	}	function sendSignUpMail($user_email, $user_name, $verify_code){		$objEmail = new Email();		$objEmail->mailaccount='start_rishta';		$objEmail->to=$user_email;		$objEmail->toname=$user_name;		$objEmail->from=Email_FROM;		$objEmail->fromname=Email_FROMNAME;		$objEmail->bcc=Email_BCC;		$objEmail->subject = 'Welcome to Startrishta!';		$objEmail->body = '<html>			<head>				<title></title>				<style type="text/css">			    	body {margin: 0; padding: 0; min-width: 100%!important;}			    	.content {width: 100%; max-width: 600px;}			    </style>			</head>			<body><!-- font-family: Open Sans,sans-serif; -->			<table width="100%" style="max-width:600px; margin:auto; " bgcolor="#E36356" border="0" cellpadding="0" cellspacing="0">				<tr>					<td style="padding-top:30px;">						<table width="95%" style="max-width:600px; margin:auto;" bgcolor="#ffffff" border="0" cellpadding="0" cellspacing="0">							<tr>								<td style="max-width:100%; width:100%; padding-top:20px;"><img src='.SITEURL.'images/logo3.png style="margin:0 auto; display:block;" width="100" height="98" alt="logo"/></td>							</tr>							<tr>								<td style="text-align:center; padding-top:20px;">									<h2 style="color:#7E7E7E; font-weight:bold; font-size: 27px;">WELCOME TO STARTRISHTA</h2>								</td>							</tr>							<tr>								<td style="padding:0 30px 25px;">									<p style="font-size:14px;">Hi '.$user_name.'!</p>								</td>							</tr>							<tr>								<td style="padding:0 30px 15px;">									<p style="font-size:14px;">Congratulations on joining Startrishta, our mission is to empower the next generation of relationships! You can chat with new and interesting people and you decide what happens next - Startrishta is what you make of it!</p>								</td>							</tr>							<tr>								<td style="padding:0 30px 15px;">									<p style="font-size:14px;">To get started, please verify your account by clicking the button below.</p>								</td>							</tr>							<tr>								<td style="padding:0 30px 15px;">									<a href="'.SITEURL.'account-verify.php?action=verifyNewSignUp&email='.md5($user_email).'									&code='.md5($verify_code).'" target="_blank" style="background:#FB4537; padding:6px 10px; border-radius:3px; border:1px solid #FB4537; display:inline-block; text-decoration:none; color:#ffffff; font-size:14px;">Click here to verify</a>								</td>							</tr>							<tr>								<td style="padding:0 30px 20px;">									<p style="font-size:14px;">We hope you have as much fun using our site as we did making it, we look forward to seeing you around.</p>								</td>							</tr>							<tr>								<td style="padding:20px 30px 20px;">									<p style="font-size:14px;">Thanks,<br>Startrishta.com Team</p>								</td>							</tr>							<tr>								<td style="padding:20px 0px 20px; text-align:center; background:#EEEEEC;">									<ul style="text-align:center; padding:0; margin:0;">										<li style="list-style:none; display:inline-block; 										font-size:12px; line-height:20px; color:#878787;">STAY CONNECTED</li>										<li style="list-style:none; display:inline-block;vertical-align: bottom;">										<a href="https://www.facebook.com/startrishta/" target="_blank" 										style="display:block;">										<img src='.SITEURL.'images/facebook-icon.png style="max-width:20px;"></a>										</li>										<li style="list-style:none; display:inline-block; vertical-align: bottom;">										<a href="https://twitter.com/startrishta" target="_blank" style="display:block;">										<img src='.SITEURL.'images/twitter-icon.png style="max-width:20px;"></a>										</li>									</ul>								</td>							</tr>						</table>					</td>				</tr>					<td>						<img src='.SITEURL.'images/bottom.png style="max-width:600px; width:100%;" />					</td>				<tr>				</tr>			</table>			</body>			</html>';			//print_r($emailObj);exit;		$email_response = $objEmail->sendemail();		return $email_response;	}    function sendSignUpMailFB($user_email, $user_name, $verify_code){        $objEmail = new Email();        $objEmail->mailaccount='start_rishta';        $objEmail->to=$user_email;        $objEmail->toname=$user_name;        $objEmail->from=Email_FROM;        $objEmail->fromname=Email_FROMNAME;        $objEmail->bcc=Email_BCC;        $objEmail->subject = 'Welcome to Startrishta!';        $objEmail->body = '<html>			<head>				<title></title>				<style type="text/css">			    	body {margin: 0; padding: 0; min-width: 100%!important;}			    	.content {width: 100%; max-width: 600px;}			    </style>			</head>			<body><!-- font-family: Open Sans,sans-serif; -->			<table width="100%" style="max-width:600px; margin:auto; " bgcolor="#E36356" border="0" cellpadding="0" cellspacing="0">				<tr>					<td style="padding-top:30px;">						<table width="95%" style="max-width:600px; margin:auto;" bgcolor="#ffffff" border="0" cellpadding="0" cellspacing="0">							<tr>								<td style="max-width:100%; width:100%; padding-top:20px;"><img src='.SITEURL.'images/logo3.png style="margin:0 auto; display:block;" width="100" height="98" alt="logo"/></td>							</tr>							<tr>								<td style="text-align:center; padding-top:20px;">									<h2 style="color:#7E7E7E; font-weight:bold; font-size: 27px;">WELCOME TO STARTRISHTA</h2>								</td>							</tr>							<tr>								<td style="padding:0 30px 25px;">									<p style="font-size:14px;">Hi '.$user_name.'!</p>								</td>							</tr>							<tr>								<td style="padding:0 30px 15px;">									<p style="font-size:14px;">Congratulations on joining Startrishta, our mission is to empower the next generation of relationships! You can chat with new and interesting people and you decide what happens next - Startrishta is what you make of it!</p>								</td>							</tr>							<tr>								<td style="padding:0 30px 20px;">									<p style="font-size:14px;">We hope you have as much fun using our site as we did making it, we look forward to seeing you around.</p>								</td>							</tr>							<tr>								<td style="padding:20px 30px 20px;">									<p style="font-size:14px;">Thanks,<br>Startrishta.com Team</p>								</td>							</tr>							<tr>								<td style="padding:20px 0px 20px; text-align:center; background:#EEEEEC;">									<ul style="text-align:center; padding:0; margin:0;">										<li style="list-style:none; display:inline-block; 										font-size:12px; line-height:20px; color:#878787;">STAY CONNECTED</li>										<li style="list-style:none; display:inline-block;vertical-align: bottom;">										<a href="https://www.facebook.com/startrishta/" target="_blank" 										style="display:block;">										<img src='.SITEURL.'images/facebook-icon.png style="max-width:20px;"></a>										</li>										<li style="list-style:none; display:inline-block; vertical-align: bottom;">										<a href="https://twitter.com/startrishta" target="_blank" style="display:block;">										<img src='.SITEURL.'images/twitter-icon.png style="max-width:20px;"></a>										</li>									</ul>								</td>							</tr>						</table>					</td>				</tr>					<td>						<img src='.SITEURL.'images/bottom.png style="max-width:600px; width:100%;" />					</td>				<tr>				</tr>			</table>			</body>			</html>';        //print_r($emailObj);exit;        $email_response = $objEmail->sendemail();        return $email_response;    }	function userSignIn($signInEmailId , $signInPassword , $rememberMe, $loginFrom="", $fbArray=array()){				if($loginFrom == "facebook")		{			//echo "<pre>";print_r($fbArray);			//extract($fbArray);			/*if($signInEmailId != '' && $signInPassword != '')			{*/				$signInQuery = mysql_query("SELECT * FROM `sr_user_login` 				INNER JOIN `sr_users` on 				`sr_users`.user_id = `sr_user_login`.user_id 				WHERE 				`sr_user_login`.email_id='".$signInEmailId."' 				AND `sr_user_login`.oauth_uid = '".$fbArray['id']."'				AND 				(`sr_users`.is_deleted = 0 OR `sr_users`.is_suspended = 0) ");				//echo "Rows ---".mysql_num_rows($signInQuery);								if($signInQuery)				{					if(mysql_num_rows($signInQuery))					{						$signInResult=mysql_fetch_assoc($signInQuery);						//echo "<pre>";print_r($signInResult);												$signUpDate=$signInResult['created_on'];						//echo "<br>Created ---- ".$signUpDate;						$signInUserId=$signInResult['user_id'];						//echo "<br>User ID ---- ".$signInUserId;												$todate = date('Y-m-d h:i:s');						$diffOfHour = round((strtotime($todate) - strtotime($signUpDate))/3600);						if($signInResult['status'] == 0 && $diffOfHour >= 72){							return 2; // not verified after 72 hour						}						if($signInResult['is_suspended'] == 1){							return 'suspend';// user suspended by admin						}						else if($signInResult['is_deleted'] == 1){							return 'deleted'; //user deleted profile						}						else if($signInResult['is_erase'] == 1){							return 'erased'; //user erased by admin						}						else {							mysql_query("UPDATE sr_users SET 								oauth_provider='facebook', is_online=1, is_verified=1 								WHERE user_id='".$signInUserId."'");							$login_time=DATE_TIME;							$_SESSION['login_time'] = $login_time;							//echo "<br> Login session ----".$_SESSION['login_time'];							//echo "<br> INSERT INTO sr_login_history SET user_id='".$signInUserId."' , 								//login_time = '".$login_time."'";							mysql_query("INSERT INTO sr_login_history SET user_id='".$signInUserId."' , 								login_time = '".$login_time."'");							// code for remember me							if($rememberMe == 1){								$this->generateLoginToken($signInUserId);							}	                       	$_SESSION['user_id'] = $signInUserId;	                       	$_SESSION['fb_user'] = $fbArray['name'];							$_SESSION['fbgen'] = $fbArray['gender'];	                       //echo "<br> Session id ---- ".$_SESSION['user_id'];							return 1; // success						}					}					else {						return 3; //incorrect usernsme or password					}				}				else{					return 0; //error 				}			/*}			else{				return 4; // required parameter missing			}*/		}		else{			extract($_POST);			if($signInEmailId != '' && $signInPassword != '')			{				$signInQuery = mysql_query("SELECT * FROM sr_user_login 				INNER JOIN sr_users on sr_users.user_id = sr_user_login.user_id 				WHERE email_id='".$signInEmailId."' AND password='".md5($signInPassword)."' 				and (sr_users.is_deleted = 0 OR sr_users.is_suspended = 0) ");				if($signInQuery){					if(mysql_num_rows($signInQuery)){						$signInResult=mysql_fetch_object($signInQuery);						//print_r($signInResult);die;						$signUpDate=$signInResult->created_on;						$signInUserId=$signInResult->user_id;						$todate = date('Y-m-d h:i:s');						$diffOfHour = round((strtotime($todate) - strtotime($signUpDate))/3600);						if($signInResult->status == 0 && $diffOfHour >= 72){						    $_SESSION['user_id'] = $signInUserId;							return 2; // not verified after 72 hour						}                        /*                         if($signInResult->status == 0){							$_SESSION['user_id']=$signInUserId;							$_SESSION['user_email'] = $signInEmailId;							return 5; // user not verified						}                        */						if($signInResult->is_suspended == 1){							return 'suspend';// user suspended by admin						}						else if($signInResult->is_deleted == 1){							return 'deleted'; //user deleted profile						}						else if($signInResult->is_erase == 1){							return 'erased'; //user erased by admin						}						else {							mysql_query("UPDATE sr_users SET is_online=1 WHERE user_id='".$signInUserId."'");							$login_time=DATE_TIME;							$_SESSION['login_time'] = $login_time;							mysql_query("INSERT INTO sr_login_history SET user_id='".$signInUserId."' , 								login_time = '".$login_time."'");							// code for remember me							if($rememberMe == 1){								$this->generateLoginToken($signInUserId);							}	                        $_SESSION['user_id'] = $signInUserId;							return 1; // success						}					}					else {						return 3; //incorrect usernsme or password					}				}				else{					return 0; //error 				}			}			else{				return 4; // required parameter missing			}		}	}	function generateRandomString($length = 10) {		$characters = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';		$charactersLength = strlen($characters);		$randomString = '';		for ($i = 0; $i < $length; $i++) {			$randomString .= $characters[rand(0, $charactersLength - 1)];		}		return $randomString;	}	function userPhotoModerate($user_id){		$photoModerateQuery = mysql_query("SELECT * FROM sr_users u, sr_user_photo p WHERE u.user_id = p.user_id AND u.user_id='".$user_id."' 		AND p.status = 2 order by p.created_on desc");		if($photoModerateQuery){			return mysql_num_rows($photoModerateQuery);		}else {			return 0;		}	}		function isVerifiedUser($user_id){		$query=mysql_query("SELECT * FROM sr_user_login WHERE sr_user_login.user_id='".$user_id."' ");//die;		$result=mysql_fetch_assoc($query);		$signUpDate=$result['created_on'];		$todate = date('Y-m-d h:i:s');		$diffOfHour = round((strtotime($todate) - strtotime($signUpDate))/3600);		if($result['status'] == 0 && $diffOfHour >= 72){			return 0;		}else if($result['status'] == 0){			return 0;		}else{			return 1;		}	}    function isSuspendUser($user_id,$chkFlag){        if(isset($_SESSION['user_id']) && ($chkFlag == 'suspend')) {            $query = mysql_query("SELECT sr_user_login.*, sr_users.is_suspended,             	sr_users.is_erase, max(sr_user_suspend.suspend_id),sr_user_suspend.reason                 FROM sr_user_login                 INNER JOIN sr_users on sr_user_login.user_id = sr_users.user_id                  INNER JOIN sr_user_suspend on sr_user_login.user_id = sr_user_suspend.user_id                  WHERE sr_user_login.user_id='" . $user_id . "' ");            $result = mysql_fetch_assoc($query);            if (($result['is_suspended'] == 1)) {                mysql_query("UPDATE sr_users SET is_online=0 WHERE user_id='" . $user_id . "'");                if(isset($_SESSION['profile_visit'])){                    mysql_query("UPDATE sr_profile_visitors SET status=0 where user_id='".$user_id."'");                }                session_destroy();                setcookie('remember', '', time() - 864000, '/') or die('unable to create cookie');                echo '0';            }            else {                echo '1';            }        }    }    function isDeletedUser($user_id,$chkFlag){        if(isset($_SESSION['user_id']) && ($chkFlag == 'deleted')) {            $query = mysql_query("SELECT sr_user_login.*,             	sr_users.is_deleted, sr_users.is_erase,             	max(sr_user_suspend.suspend_id), sr_user_suspend.reason                 FROM sr_user_login                 INNER JOIN sr_users on sr_user_login.user_id = sr_users.user_id                  INNER JOIN sr_user_suspend on sr_user_login.user_id = sr_user_suspend.user_id                  WHERE sr_user_login.user_id='".$user_id."' ");            $result=mysql_fetch_assoc($query);           // print_r($result);            if($result['is_deleted'] == 1){            	$this->sendDeleteUserMail($user_id);                mysql_query("UPDATE sr_users SET is_online=0 WHERE user_id='" . $user_id . "'");                if(isset($_SESSION['profile_visit'])){                    mysql_query("UPDATE sr_profile_visitors SET status=0 where user_id='".$user_id."'");                }                session_destroy();                setcookie('remember', '', time() - 864000, '/') or die('unable to create cookie');                echo '0';            }else{                echo '1';            }        }    }    # SEND MAIL TO USERS On Profile Visitor	function sendDeleteUserMail($user_id='')	{		$senderDet = $this->getUserInfo($user_id);				$profileUser = mysql_query("Select user_name, dob, user_id, email_id 			from sr_users JOIN sr_user_login on sr_users.user_id = sr_user_login.user_id 			where sr_users.user_id = '".$user_id."' ");		$profileUserFetch = mysql_fetch_array($profileUser);		//print_r(explode(',',$user_email));die;		$objEmail = new Email();		$objEmail->mailaccount='start_rishta';		$objEmail->to=$profileUserFetch['email_id'];		$objEmail->toname = $profileUserFetch['user_name'];		$objEmail->from=ADMINMAIL2;		$objEmail->fromname=Email_FROMNAME;		$objEmail->bcc=Email_BCC;		$objEmail->subject = "Goodbye..for now!";				$objEmail->body = '<html>		<head>			<title></title>			<style type="text/css">		    	body {margin: 0; padding: 0; min-width: 100%!important;}		    	.content {width: 100%; max-width: 600px;}		    </style>		</head>		<body><!-- font-family: Open Sans,sans-serif; -->		<table width="100%" style="max-width:600px; margin:auto;" bgcolor="#E36356" border="0" 		cellpadding="0" cellspacing="0">			<tr>				<td style="padding-top:30px;">					<table width="95%" style="max-width:600px; margin:auto;" bgcolor="#ffffff" border="0" cellpadding="0" cellspacing="0">						<tr>							<td style="max-width:100%; width:100%; padding-top:20px;">							<img src='.SITEURL.'images/logo3.png style="margin:0 auto; display:block;" width="100" height="98" alt="logo"/></td>						</tr>						<tr>							<td style="text-align:center; padding-top:20px;">								<h2 style="color:#7E7E7E; font-weight:bold; font-size: 27px;">								Hi '.$profileUserFetch['user_name'].' </h2>							</td>						</tr>						<tr>							<td style="padding:0 30px 15px;">								Your account has been deleted!							</td>						</tr>						<tr>		                    <td style="padding:0 30px 15px;">		                        We hope you’ve had a fantastic time using Startrishta and we’re sad to 		                        see you leave. 		                        Remember, you are welcome back anytime and you’ll be able to pick up 		                        where you left off – talking to awesome new people and having fun!		                    </td>		                </tr>						<tr>							<td style="padding:20px 30px 20px;">								<p style="font-size:14px;">See you around!<br>Startrishta.com Team</p>							</td>						</tr>						<tr>							<td style="padding:20px 0px 20px; text-align:center; background:#EEEEEC;">								<ul style="text-align:center; padding:0; margin:0;">										<li style="list-style:none; display:inline-block; 										font-size:12px; line-height:20px; color:#878787;">STAY CONNECTED</li>										<li style="list-style:none; display:inline-block;vertical-align: bottom;">										<a href="https://www.facebook.com/startrishta/" target="_blank" 										style="display:block;">										<img src='.SITEURL.'images/facebook-icon.png style="max-width:20px;"></a>										</li>										<li style="list-style:none; display:inline-block; vertical-align: bottom;">										<a href="https://twitter.com/startrishta" target="_blank" style="display:block;">										<img src='.SITEURL.'images/twitter-icon.png style="max-width:20px;"></a>										</li>									</ul>							</td>						</tr>					</table>				</td>			</tr>				<td>					<img src='.SITEURL.'images/bottom.png style="max-width:600px; width:100%;" />				</td>			<tr>			</tr>		</table>		</body>		</html>';		//echo "<pre>";print_r($objEmail);//exit;		$email_response = $objEmail->sendemail();		//echo "<pre>";print_r($email_response);exit;		return $email_response;	}    #Password Reset Mail    function sendResetPasswordMail($user_name , $user_email , $verify_code)	{		$objEmail = new Email();		$objEmail->mailaccount='start_rishta';		$objEmail->to=$user_email;		$objEmail->toname=$user_name;		$objEmail->from=ADMINMAIL2;		$objEmail->fromname=Email_FROMNAME;		$objEmail->bcc=Email_BCC;		$objEmail->subject = "Startrishta: Password Reset Link";		$objEmail->body = '<html>		<head>			<title></title>			<style type="text/css">		    	body {margin: 0; padding: 0; min-width: 100%!important;}		    	.content {width: 100%; max-width: 600px;}		    </style>		</head>		<body><!-- font-family: Open Sans,sans-serif; -->		<table width="100%" style="max-width:600px; margin:auto; " bgcolor="#E36356" border="0" cellpadding="0" cellspacing="0">			<tr>				<td style="padding-top:30px;">					<table width="95%" style="max-width:600px; margin:auto;" bgcolor="#ffffff" border="0" cellpadding="0" cellspacing="0">						<tr>							<td style="max-width:100%; width:100%; padding-top:20px;"><img src='.SITEURL.'images/logo3.png style="margin:0 auto; display:block;" width="100" height="98" alt="logo"/></td>						</tr>						<tr>							<td style="text-align:center; padding-top:20px;">								<h2 style="color:#7E7E7E; font-weight:bold; font-size: 27px;">Forgot your Password? </h2>							</td>						</tr>						<tr>							<td style="padding:0 30px 15px;">								<p style="font-size:14px;">We received a request to reset the password for your Startrishta account <strong>'.$user_email.'</strong>									<br />To reset your password, click on the link below.<br/><br/><br/></p>							</td>						</tr>						<tr>							<td style="padding:0 30px 15px;">								<a href="'.SITEURL."new-password.php?id=".md5($user_email)."&code=".md5($verify_code).'" target="_blank" style="background:#FB4537; padding:6px 10px; border-radius:3px; border:1px solid #FB4537; display:inline-block; text-decoration:none; color:#ffffff; font-size:14px;">Click here to reset password</a>							</td>						</tr>						<tr>							<td style="padding:20px 30px 20px;">								<p style="font-size:14px;">Thanks,<br>Startrishta.com Team</p>							</td>						</tr>						<tr>							<td style="padding:20px 0px 20px; text-align:center; background:#EEEEEC;">								<ul style="text-align:center; padding:0; margin:0;">									<li style="list-style:none; display:inline-block; 									font-size:12px; line-height:20px; color:#878787;">STAY CONNECTED</li>									<li style="list-style:none; display:inline-block;vertical-align: bottom;">									<a href="https://www.facebook.com/startrishta/" target="_blank" 									style="display:block;">									<img src='.SITEURL.'images/facebook-icon.png style="max-width:20px;"></a>									</li>									<li style="list-style:none; display:inline-block; vertical-align: bottom;">									<a href="https://twitter.com/startrishta" target="_blank" style="display:block;">									<img src='.SITEURL.'images/twitter-icon.png style="max-width:20px;"></a>									</li>								</ul>							</td>						</tr>					</table>				</td>			</tr>				<td>					<img src='.SITEURL.'images/bottom.png style="max-width:600px; width:100%;" />				</td>			<tr>			</tr>		</table>		</body>		</html>';		//print_r($emailObj);exit;		$email_response = $objEmail->sendemail();		return $email_response;	}			#Password reset successfully mail	function sendResetPasswordConfirmationMail($user_email)	{		$objEmail = new Email();		$objEmail->mailaccount='start_rishta';		$objEmail->to=$user_email;		$objEmail->from=ADMINMAIL2;		$objEmail->fromname=Email_FROMNAME;		$objEmail->bcc=Email_BCC;		$objEmail->subject = "Startrishta: Password Successfully Changed";		$objEmail->body = '<html>			<head>				<title></title>				<style type="text/css">			    	body {margin: 0; padding: 0; min-width: 100%!important;}			    	.content {width: 100%; max-width: 600px;}			    </style>			</head>			<body><!-- font-family: Open Sans,sans-serif; -->			<table width="100%" style="max-width:600px; margin:auto; " bgcolor="#E36356" border="0" cellpadding="0" cellspacing="0">				<tr>					<td style="padding-top:30px;">						<table width="95%" style="max-width:600px; margin:auto;" bgcolor="#ffffff" border="0" cellpadding="0" cellspacing="0">							<tr>								<td style="max-width:100%; width:100%; padding-top:20px;"><img src='.SITEURL.'images/logo3.png style="margin:0 auto; display:block;" width="100" height="98" alt="logo"/></td>							</tr>							<tr>								<td style="text-align:center; padding-top:20px;">									<h2 style="color:#7E7E7E; font-weight:bold; font-size: 27px;">Your password have been reset. </h2>								</td>							</tr>							<tr>								<td style="padding:0 30px 15px;">									<p style="font-size:14px;">Congratulations you have successfully reset your password for your Startrishta account <b>'.$user_email.'</b>. Use your new details to login below.<br><br/><br/></p>								</td>							</tr>							<tr>								<td style="padding:0 30px 15px;">									 <a  href="'.SITEURL.'account-verify.php?action=passwordReset">											 <span style="background:#e74c3c;text-decoration:none; border:none;border-radius: 3px;color: #fff;cursor: pointer;font-size: 13px;font-weight: 500 !important; padding: 5px 9px; display:block; float:left;">Login to Startrishta</span></a><br/><br/>								</td>							</tr>							<tr>								<td style="padding:20px 30px 20px;">									<p style="font-size:14px;">Thanks,<br>Startrishta.com Team</p>								</td>							</tr>							<tr>								<td style="padding:20px 0px 20px; text-align:center; background:#EEEEEC;">									<ul style="text-align:center; padding:0; margin:0;">										<li style="list-style:none; display:inline-block; font-size:12px; line-height:20px; color:#878787;">STAY CONNECTED</li>										<li style="list-style:none; display:inline-block; vertical-align: bottom;"><a href="#" target="_blank" style="display:block;"><img src='.SITEURL.'images/facebook-icon.png style="max-width:20px;"></a></li>										<li style="list-style:none; display:inline-block; vertical-align: bottom;"><a href="#" target="_blank" style="display:block;"><img src='.SITEURL.'images/twitter-icon.png style="max-width:20px;"></a></li>									</ul>								</td>							</tr>						</table>					</td>				</tr>					<td>						<img src='.SITEURL.'images/bottom.png style="max-width:600px; width:100%;" />					</td>				<tr>				</tr>			</table>			</body>			</html>';		//print_r($emailObj);exit;		$email_response = $objEmail->sendemail();		return $email_response;	}			function getTimeToStr($ts)	{		if(!ctype_digit($ts))			$ts = strtotime($ts);		$diff = time() - $ts;		if($diff == 0)			return 'just now';		elseif($diff > 0)		{			$day_diff = floor($diff / 86400);			if($day_diff == 0)			{				if($diff < 60) return 'just now';				if($diff < 120) return '1 minute ago';				if($diff < 3600) return floor($diff / 60) . ' minutes ago';				if($diff < 7200) return '1 hour ago';				if($diff < 86400) return floor($diff / 3600) . ' hours ago';			}			if($day_diff == 1) return 'Yesterday';			if($day_diff < 7) return $day_diff . ' days ago';			if($day_diff < 31){ if(ceil($day_diff / 7)==1){return '1 week ago';}else{ return ceil($day_diff / 7) . ' weeks ago';}}			if($day_diff < 60) return 'last month';			return date('d F Y', $ts);		}		else		{			$diff = abs($diff);			$day_diff = floor($diff / 86400);			if($day_diff == 0)			{				if($diff < 120) return 'in a minute';				if($diff < 3600) return 'in ' . floor($diff / 60) . ' minutes';				if($diff < 7200) return 'in an hour';				if($diff < 86400) return 'in ' . floor($diff / 3600) . ' hours';			}			if($day_diff == 1) return 'Tomorrow';			if($day_diff < 4) return date('l', $ts);			if($day_diff < 7 + (7 - date('w'))) return 'next week';			if(ceil($day_diff / 7) < 4) return 'in ' . ceil($day_diff / 7) . ' weeks';			if(date('n', $ts) == date('n') + 1) return 'next month';			return date('d F Y', $ts);		}	}		function getCurrency(){		$result=array();		$query = mysql_query("SELECT * FROM sr_currency WHERE status = 1");		if($query){			while($result=mysql_fetch_assoc($query)){				$array[]=$result;			}			}		return $array;		}		#Log Details	function logDetails($userID = '')	{		$array = array();		$query = mysql_query("Select * from sr_user_login where user_id = '".$userID."' ");		if( mysql_num_rows($query)>0 )		{			while( $queryFetch = mysql_fetch_assoc($query) ){				$array[] = $queryFetch;			}		}		return $array;	}			# SEND MAIL TO USERS TO JOIN START RISHTA	function sendAddFriendMail( $user_email , $user_id )	{		$senderDet = $this->getUserInfo($user_id);		$objEmail = new Email();		$objEmail->mailaccount='start_rishta';		$objEmail->to=$user_email;		$objEmail->from=ADMINMAIL2;		$objEmail->fromname=Email_FROMNAME;		$objEmail->bcc=Email_BCC;		$objEmail->subject = "Someone you know wants you to join Startrishta!";		$objEmail->body = '<html>		<head>			<title></title>			<style type="text/css">		    	body {margin: 0; padding: 0; min-width: 100%!important;}		    	.content {width: 100%; max-width: 600px;}		    </style>		</head>		<body><!-- font-family: Open Sans,sans-serif; -->		<table width="100%" style="max-width:600px; margin:auto; " bgcolor="#E36356" border="0" cellpadding="0" cellspacing="0">			<tr>				<td style="padding-top:30px;">					<table width="95%" style="max-width:600px; margin:auto;" bgcolor="#ffffff" border="0" cellpadding="0" cellspacing="0">						<tr>							<td style="max-width:100%; width:100%; padding-top:20px;"><img src='.SITEURL.'images/logo3.png style="margin:0 auto; display:block;" width="100" height="98" alt="logo"/></td>						</tr>						<tr>							<td style="text-align:center; padding-top:20px;">								<h2 style="color:#7E7E7E; font-weight:bold; font-size: 27px;">Hi, </h2>							</td>						</tr>						<tr>							<td style="padding:0 30px 15px;">								<p style="font-size:14px;"><strong>".$senderDet[user_name]."</strong> wants you to join Startrishta! You can chat with new and interesting people here and get to decide what happens next - Startrishta is what you make of it!<br /><br /><br />										<a href="'.SITEURL.'index.php?id="'.md5($user_id).'">click here</a> to join Startrishta<br><br/><br/></p>							</td>						</tr>						<tr>							<td style="padding:20px 30px 20px;">								<p style="font-size:14px;">Thanks,<br>Startrishta.com Team</p>							</td>						</tr>						<tr>							<td style="padding:20px 0px 20px; text-align:center; background:#EEEEEC;">								<ul style="text-align:center; padding:0; margin:0;">									<li style="list-style:none; display:inline-block; font-size:12px; line-height:20px; color:#878787;">STAY CONNECTED</li>									<li style="list-style:none; display:inline-block; vertical-align: bottom;"><a href="#" target="_blank" style="display:block;"><img src='.SITEURL.'images/facebook-icon.png style="max-width:20px;"></a></li>									<li style="list-style:none; display:inline-block; vertical-align: bottom;"><a href="#" target="_blank" style="display:block;"><img src='.SITEURL.'images/twitter-icon.png style="max-width:20px;"></a></li>								</ul>							</td>						</tr>					</table>				</td>			</tr>				<td>					<img src='.SITEURL.'images/bottom.png style="max-width:600px; width:100%;" />				</td>			<tr>			</tr>		</table>		</body>		</html>';		//print_r($emailObj);exit;		$email_response = $objEmail->sendemail();		return $email_response;	}		# SEND MAIL TO USERS On Updating email	function sendEmailChangeMail($user_email='', $user_name='', $verify_code='')	{		#Find sender details		$senderDet = $this->getUserInfo($user_id);		$objEmail = new Email();		$objEmail->mailaccount='start_rishta';		$objEmail->to=$user_email;		$objEmail->from=ADMINMAIL2;		$objEmail->fromname=Email_FROMNAME;		$objEmail->bcc=Email_BCC;		$objEmail->subject = "StartRishta: Email change verification";		$objEmail->body = '<html>			<head>				<title></title>				<style type="text/css">			    	body {margin: 0; padding: 0; min-width: 100%!important;}			    	.content {width: 100%; max-width: 600px;}			    </style>			</head>			<body><!-- font-family: Open Sans,sans-serif; -->			<table width="100%" style="max-width:600px; margin:auto; " bgcolor="#E36356" border="0" cellpadding="0" cellspacing="0">				<tr>					<td style="padding-top:30px;">						<table width="95%" style="max-width:600px; margin:auto;" bgcolor="#ffffff" border="0" cellpadding="0" cellspacing="0">							<tr>								<td style="max-width:100%; width:100%; padding-top:20px;"><img src='.SITEURL.'images/logo3.png style="margin:0 auto; display:block;" width="100" height="98" alt="logo"/></td>							</tr>							<tr>								<td style="text-align:center; padding-top:20px;">									<h2 style="color:#7E7E7E; font-weight:bold; font-size: 27px;">You have requested to change your email address </h2>								</td>							</tr>							<tr>								<td style="padding:0 30px 15px;">									We\'ve received a request to change your Startrishta email to <strong>"'.$user_email.'"</strong>. Please verify this below to continue<br /><br />									<a style="background:#e74c3c;text-decoration:none; border:none;border-radius: 3px;color: #fff;cursor: pointer;font-size: 12px;font-weight: 400 !important;padding: 5px 9px;" href='.SITEURL.'account-verify.php?action=verifySignUp&email="'.md5($user_email).'"&code="'.md5($verify_code).'" />Click here to verify</a><br><br/><br/>								</td>							</tr>							<tr>								<td style="padding:20px 30px 20px;">									<p style="font-size:14px;">Thanks,<br>Startrishta.com Team</p>								</td>							</tr>							<tr>								<td style="padding:20px 0px 20px; text-align:center; background:#EEEEEC;">									<ul style="text-align:center; padding:0; margin:0;">										<li style="list-style:none; display:inline-block; 										font-size:12px; line-height:20px; color:#878787;">STAY CONNECTED</li>										<li style="list-style:none; display:inline-block;vertical-align: bottom;">										<a href="https://www.facebook.com/startrishta/" target="_blank" 										style="display:block;">										<img src='.SITEURL.'images/facebook-icon.png style="max-width:20px;"></a>										</li>										<li style="list-style:none; display:inline-block; vertical-align: bottom;">										<a href="https://twitter.com/startrishta" target="_blank" style="display:block;">										<img src='.SITEURL.'images/twitter-icon.png style="max-width:20px;"></a>										</li>									</ul>								</td>							</tr>						</table>					</td>				</tr>					<td>						<img src='.SITEURL.'images/bottom.png style="max-width:600px; width:100%;" />					</td>				<tr>				</tr>			</table>			</body>			</html>';		//print_r($emailObj);exit;		$email_response = $objEmail->sendemail();		return $email_response;	}		function getProfilePercent($userResult){		//print_r($userResult);		$percentage=0;		$add=25/4;		//echo $userResult['sexuality'];		if($userResult['sexuality'] != '' )		{ 			if($userResult['sexuality'] != 0 )			{ 				$percentage += $add;			}		}		//echo "<br>".$userResult['relationship_status'];		if($userResult['relationship_status'] != ''){			if($userResult['relationship_status'] != 0){				$percentage += $add;			}		}		//echo $userResult['star_sign'];		if($userResult['star_sign'] != ''){			if($userResult['star_sign'] != 0){				$percentage += $add;			}		}		//echo "<br>".$userResult['body_type'];		if($userResult['body_type'] != ''){			if($userResult['body_type'] != 0){				$percentage += $add;			}		}		//echo "<br>".$userResult['complexion'];		if($userResult['complexion'] != ''){			if($userResult['complexion'] != 0){				$percentage += $add;			}		}		//echo "<br>".$userResult['height'];		if($userResult['height'] != ''){			if($userResult['height'] != 0){				$percentage += $add;			}		}		//echo "<br>".$userResult['eye_color'];		if($userResult['eye_color'] != ''){			if($userResult['eye_color'] != 0){				$percentage += $add;			}		}		//echo "<br>".$userResult['hair_color'];		if($userResult['hair_color'] != ''){			if($userResult['hair_color'] != 0){				$percentage += $add;			}		}		//echo "<br>".$userResult['language'];		if($userResult['language'] != ''){			//if($userResult['language'] != 0){				$percentage += $add;			//}		}		//echo "<br>".$userResult['smoking'];		if($userResult['smoking'] != ''){			$percentage += $add;		}		//echo "<br>".$userResult['drinking'];		if($userResult['drinking'] != ''){			$percentage += $add;		}		//echo "<br>".$userResult['kids'];		if($userResult['kids'] != ''){			//if($userResult['kids'] != 0){				$percentage += $add;			//}		}		//echo "<br>".$userResult['education'];		if($userResult['education'] != ''){			if($userResult['education'] != 0){				$percentage += $add;			}		}		//echo "<br>".$userResult['work'];		if($userResult['work'] != ''){			//if($userResult['work'] != 0){				$percentage += $add;			//}		}		//echo "<br>".$userResult['income'];		if($userResult['income'] != ''){			if($userResult['income'] != 0){				$percentage += $add;			}		}		//echo "<br>".$userResult['company'];		if($userResult['company'] != ''){			//if($userResult['company'] != 0){				$percentage += $add;			//}		}		return $percentage;	}	function importFbPics($fbArray, $photos){		foreach($photos as $picture) {			$img = parse_url($picture['picture']);			$path = explode('/', $img['path']);			$filename = end($path);			$url = "/home/startrishta/beta-dev/public_html/upload/";			$thumbdir = $url."photo/thumb/";			$dir = $url."photo/";			$dir200 = $url."photo/200X200/";			//echo getcwd();			define('DIRECTORY', '/home/startrishta/public_html/beta-dev/upload/photo/');			$content = file_get_contents($picture['picture']);			echo "Dir ------ ".DIRECTORY . $filename."<br><br>";			if(file_put_contents(DIRECTORY . $filename, $content)){				echo "Dir123 ------ ".DIRECTORY . $filename."<br><br>";			}else{				echo "Content ----- ".$content."<br><br>";			}			/*$chkPhoto = mysql_num_rows(mysql_query("select photo from sr_user_photo where 				user_id = '".$_SESSION['user_id']."' and from_facebook='1' and photo = '".$filename."'"));			if($chkPhoto < 1){								$query = mysql_query('INSERT into `sr_user_photo` set 				`user_id`='.$_SESSION['user_id'].', `photo`="'.$filename.'", `caption`="", 				`status`=1, `filepath` = "'.$dir.'", `thumbfilepath` = "'.$thumbdir.'", 				`thumbfilepath200x200` = "'.$dir200.'", `private`=0, `photo_type`=1, 				`rate_status`=0, `is_profileImage`=0, `from_facebook`="1", `created_on`=now(), 				`created_by`=1, `updated_by`="'.$_SESSION['user_id'].'", `updated_on`=now()');			}*/		}		/*if($query){			return 1;		}*/	}}function get_user_address(){}?><?php if(isset($_REQUEST['action']) && $_REQUEST['action']=='updatecounter'){	$userProfileObj=new User();	$user_id = $_SESSION['user_id'];	$profileVisitorArray = $userProfileObj->getProfileVisitor($user_id);	$profileVisitorCount=count($profileVisitorArray);	// var_dump($profileVisitorArray);	// die();	$likeMeArray=$userProfileObj->getLikeMe($user_id);	$userLikeCount=count($likeMeArray);	$userFavouriteCount=$userProfileObj->userFavouriteCount($user_id);	$userBlockCount=$userProfileObj->userBlockCount($user_id);	$ratedMeUserArray=$userProfileObj->getRatedMeUser($user_id);	$getRatedMeUserCount=count($ratedMeUserArray);	$allMyPhotoArray = $userProfileObj->getMyPhotoComment($user_id);	$allMyPhotoCount = count($allMyPhotoArray);	$otherPhotoArray = $userProfileObj->getOtherPhotoComment($user_id);	$otherPhotoCount = count($otherPhotoArray);	$userResult = $userProfileObj->getUserInfo($user_id);	?>		<div class="list-group custom">			<?php if($userResult['profile_image']){?>				<a href="profile-visitor.php" class="list-group-item <?php if($page == 'profile-visitor') echo 'disabled';?>">					<span class="pv"></span> Profile Visitors <span class="badge"  id="visitorCount1"><?php echo $profileVisitorCount;?></span>				</a>			<?php }else{ ?>				<a href="javascript:void(0);" class="list-group-item <?php if($page == 'profile-visitor') echo 'disabled';?>" data-toggle="modal" data-target="#addProfilePhotoModal">					<span class="pv"></span> Profile Visitors <span class="badge"  id="visitorCount1"><?php echo $profileVisitorCount;?></span>				</a>			<?php }?>			<a href="like.php" class="list-group-item <?php if($page == 'like') echo 'disabled';?>">				<span class="lm"></span> Liked Me <span class="badge" id="userLikeCountL"><?php echo $userLikeCount;?></span>			</a>			<a href="rated-me.php" class="list-group-item <?php if($page == 'rated-me') echo 'disabled';?>">				<span class="rmp"></span> Rated My Photos <span class="badge"><?php echo $getRatedMeUserCount;?></span>			</a>			<a href="favorites-main.php" class="list-group-item <?php if($page == 'favorites') echo 'disabled';?>">				<span class="mf"></span> My Favourites <span class="badge" id="myfavCount"><?php echo $userFavouriteCount;?></span>			</a>			<a href="comments.php" class="list-group-item <?php if($page == 'comment') echo 'disabled';?>">				<span class="com"></span> Comments <span class="badge"><?php echo $allMyPhotoCount+ $otherPhotoCount;?></span>			</a>			<a href="blocked.php" class="list-group-item <?php if($page == 'block') echo 'disabled';?>">				<span class="blk"></span> Blocked <span class="badge" id="blockCount1"><?php echo $userBlockCount;?></span>			</a>		</div>	<?php	die();}?>