<?phprequire('../classes/user_class.php');$userProfileObj=new User();$user_id=$_SESSION['user_id'];/*##################################BASIC INFORMATION############################*/if(isset($_POST['action']) && $_POST['action']=='saveBasicInfo'){	$user_name=$_POST['user_name'];	$dob=$_POST['dob'];	$dobMsg ='';	$dateOfBirth ='';	$displayDob ='';	if($user_name != ''){		$updateQuery=mysql_query("UPDATE sr_users SET user_name='".$user_name."', dob = STR_TO_DATE('$dob','%d-%m-%Y') , updated_on='".DATE_TIME."' , dob_update = dob_update +1 WHERE user_id='".$user_id."'");		if($updateQuery){			$userResult = $userProfileObj->getUserInfo($user_id);						if($userResult['dob_update'] >= 2){				$dateOfBirth = '<li>						<label class="red">Date Of Birth</label>						<input type="text" name="dob" id="user_dob" class="input-group" data-date-format="yyyy-mm-dd" value="'.date('d-m-Y' , strtotime($dob)).'" disabled />					</li>';			}else{				$dateOfBirth = '<li>						<label class="red">Date Of Birth</label>						<input type="text" name="dob" id="user_dob" class="input-group" data-date-format="yyyy-mm-dd" value="'.date('d-m-Y' , strtotime($dob)).'" />					</li>';			}			if($userResult['dob_update'] == 0){				$dobMsg = '<li><div>Age can only be <strong>changed two times</strong></div></li>';			}else if($userResult['dob_update'] == 1){				$dobMsg = '<li><div>Age can only be <strong>changed once more</strong></div></li>';			} 			if($dob != ''){ 				$displayDob = ' , '.(date('Y') - date('Y' ,strtotime($dob))); 			}			/*#############################EDIT#####################################*/			$result['edit'] = '<form class="pro_name" method="post">				<ul>					<li>						<label class="red">Name</label>						<input type="text" name="user_name" id="user_name" class="edit_user_name" value="'.$user_name.'"/>					</li>'.$dateOfBirth.'				</ul>				<ul class="pro_edit_btn">					<li>						<input class="btn pull-left" type="button" value="Save" id="save-basic-info"/> <div class="cancel">or   <a href="javascript:void(0);" id="cancel-basic-info">Cancel</a></div></li>'.$dobMsg.'				</ul>			</form>';			/*################################VIEW#################################*/			$result['view'] = '<span class="pro_name_m" id="userName">'.$user_name.'</span>			<span class="pro_age_m" id="userDob">'.$displayDob.'</span>';						echo $response = json_encode($result);		}		else {			echo 0;		}	}else{		echo 2;	}}/*#############################HERE TO##########################################*/if(isset($_POST['action']) && $_POST['action']=='saveHereTo'){	$here_to=mysql_real_escape_string($_POST['here_to']);	$here_age_min=$_POST['here_age_min'];	$here_age_max=$_POST['here_age_max'];	$here_with_girl=$_POST['here_with_girl'];	$here_with_guy=$_POST['here_with_guy'];		$query=mysql_query("UPDATE `sr_users` SET here_to = '".$here_to."' ,here_age_min = '".$here_age_min."',here_age_max = '".$here_age_max."' ,here_with_guy = '".$here_with_guy."' ,here_with_girl = '".$here_with_girl."'  WHERE user_id='".$user_id."'"); 	if($query){		$result[0] = 1;		$result[1] = $userProfileObj->getHereToName($here_to);		echo $response = json_encode($result);	}else {		echo 0;	}}/*#############################Location##########################################*/if(isset($_POST['action']) && $_POST['action']=='saveLocation'){	$location=mysql_real_escape_string($_POST['location']);	$location_lat=$_POST['location_lat'];	$location_lon=$_POST['location_lon'];	$city = '';	$country = '';	if($location_lat !='' && $location_lon != ''){				$geocode=file_get_contents('http://maps.googleapis.com/maps/api/geocode/json?latlng='.$location_lat.','.$location_lon.'&sensor=false');		$output= json_decode($geocode);		for($j=0;$j<count($output->results[0]->address_components);$j++){			if($output->results[0]->address_components[$j]->types[0] == 'locality'){				$city = $output->results[0]->address_components[$j]->long_name;			}			if($output->results[0]->address_components[$j]->types[0] == 'country'){				$country = $output->results[0]->address_components[$j]->long_name;			}        }		$query=mysql_query("UPDATE `sr_users` SET location = '".$location."', location_lat = '".$location_lat."', location_lon = '".$location_lon."',city = '".$city."' ,country = '".$country."' WHERE user_id='".$user_id."'"); 		if($query){			echo 1;		}else {			echo 0;		}	}else{		echo 0;	}}/*#############################INTEREST##########################################*/if(isset($_POST['action']) && $_POST['action']=='interestFilter'){		$filter=mysql_real_escape_string($_POST['interestFilter']);	$interest_hidden='';	if(isset($_POST['interests'])){		$interestArr=$_POST['interests'];		$interest_hidden=implode(',' , $interestArr);	}	if($filter != ''){		if($interest_hidden != ''){			$interestQuery=mysql_query("SELECT * FROM sr_interest WHERE status='1' AND interest like '%$filter%' AND interest_id NOT IN(".$interest_hidden.") LIMIT 0,8"); 		}else{			$interestQuery=mysql_query("SELECT * FROM sr_interest WHERE status='1' AND interest like '%$filter%' LIMIT 0,8"); 		}		$interestIdArray = $userProfileObj->getInterestIds($user_id);		if(mysql_num_rows($interestQuery)){			while($interestResult=mysql_fetch_object($interestQuery)){				if(!in_array($interestResult->interest_id, $interestIdArray)){				/*	$interestDisplay='none';				}else{					$interestDisplay='block';				}*/			?>				<li class="interest-section" data-value="<?php echo $interestResult->interest;?>" data-id="<?php echo $interestResult->interest_id;?>" data-title="<?php echo $interestResult->icon;?>" id="interest_li-<?php echo $interestResult->interest_id;?>">					<a class="btn_intst" href="javascript:void(0)" >					<i><img src="images/interest/<?php echo $interestResult->icon;?>.png"/></i><?php echo $interestResult->interest;?></a>				</li>			<?php }			}			echo '<li id="add_new_interset1" class="dropdown-toggle" data-toggle="dropdown"> 					<a href="javascript:void(0);">Add new interest</a>				</li>';		} else { ?>			<li id="add_new_interset"> 				<a id="add_new_interest_popup" href="javascript:void(0);" data-value="<?php echo $filter;?>">Add '<?php echo $filter ;?>' as a new interest</a>			</li>	<?php }	}}if(isset($_POST['action']) && $_POST['action']=='saveInterest'){		if(isset($_POST['interest'])){		$interestArr = $_POST['interest'];		foreach($interestArr as $interest_id){			$query=mysql_query("INSERT INTO `sr_user_interest` SET interest_id = '".$interest_id."' ,user_id = '".$user_id."' ,status=1 ,created_on = '".DATE_TIME."',updated_on='".DATE_TIME."'"); 		}	}	/*if($query){*/	$alreadyaddedInterest ='';	$addedInterest ='';	$viewInterest ='';	$response = array();	$userInterestQuery = $userProfileObj->getUserInterest($user_id);	$userInterestCount=mysql_num_rows($userInterestQuery);			while($userInterestResult = mysql_fetch_assoc($userInterestQuery)){		$alreadyaddedInterest .= '<li class="alert-dismissible" role="alert">			<a href="javascript:void(0)">				<span class="'.$userInterestResult['icon'].'" ></span>				<p>'.$userInterestResult['interest'].'</p>				<i class="fa fa-times delete_interest" id="delete_interest-'.$userInterestResult['user_interest_id'].'" data-dismiss="alert" aria-label="Close"></i>			</a>		</li>';		$addedInterest .= '<li><a href="javascript:void(0);"><span class="'.$userInterestResult['icon'].'"></span><p>'.$userInterestResult['interest'].'</p></a></li>';	}	$viewInterest  = '<div class="pro_ttl margin-b5"><span>Interests</span> 			<span class="badge margin-r5i">'.$userInterestCount.'</span>   			<a href="javascript:void(0);" id="edit-interest" class="edit bg">				<i class="fa fa-pencil"></i>				<span class="pull-right">edit</span>			</a>		</div>		<div class="interests">			<ul>'.$addedInterest.'</ul>		</div>';	$response['view']=$viewInterest;	$response['edit']=$alreadyaddedInterest;	echo json_encode($response);}if(isset($_POST['action']) && $_POST['action']=='countInterest'){	/*if(isset($_POST['interest'])){		$interestArr = $_POST['interest'];		foreach($interestArr as $interest_id){			$query=mysql_query("INSERT INTO `sr_user_interest` SET interest_id = '".$interest_id."' ,user_id = '".$user_id."' ,status=1, 			created_on = '".DATE_TIME."',updated_on='".DATE_TIME."'"); 		}	}*/	$userInterestQuery = $userProfileObj->getUserInterest($user_id);	echo $userInterestCount=mysql_num_rows($userInterestQuery);	}/*##############################ABOUT ME#########################################*/if(isset($_POST['action']) && $_POST['action']=='saveAboutMe'){	$aboutMe=mysql_real_escape_string($_POST['aboutMe']);	$aboutMe=trim($aboutMe);	$query=mysql_query("UPDATE `sr_users` SET about_me = '".$aboutMe."' WHERE user_id='".$user_id."'"); 	if($query){		$length=strlen($aboutMe);		if($length >= 30){			$repQuery=mysql_query("SELECT * FROM sr_user_reputation WHERE user_id='".$user_id."' AND reputation_type=2 AND status='1'");			if(mysql_num_rows($repQuery) == 0){				mysql_query("INSERT INTO sr_user_reputation SET reputation=10 , user_id='".$user_id."' , reputation_type=2 , datetime ='".DATE_TIME."' , status='1'");			}		}else{			mysql_query("DELETE FROM sr_user_reputation WHERE user_id='".$user_id."' AND reputation_type=2");		}		/*************stickers		$profileQuery=mysql_query("SELECT user_id FROM sr_users WHERE user_id = '".$user_id."' AND about_me != '' AND looking_for != ''");		$profileCount=mysql_num_rows($profileQuery);		if($profileCount){			$sickerQuery =mysql_query("SELECT user_sticker_id FROM sr_user_sticker WHERE sticker_id = 5 AND user_id = '".$user_id."'");			if(mysql_num_rows($sickerQuery) == 0) {				mysql_query("INSERT INTO `sr_user_sticker` SET sticker_id = 5 , user_id = '".$user_id."' , awarded_on ='".DATE_TIME."'");			}		}*********************/		echo 1;	}else {		echo 0;	}}/*################################LOOKING FOR#####################################*/if(isset($_POST['action']) && $_POST['action']=='saveLookingFor'){	$lookingFor=mysql_real_escape_string($_POST['looking_for']);	$lookingFor=trim($lookingFor);	$query=mysql_query("UPDATE `sr_users` SET looking_for = '".$lookingFor."' WHERE user_id='".$user_id."'"); 	if($query){		$length=strlen($lookingFor);		if($length >= 30){			$repQuery=mysql_query("SELECT * FROM sr_user_reputation WHERE user_id='".$user_id."' AND reputation_type=3 AND status='1'");			if(mysql_num_rows($repQuery) == 0){				mysql_query("INSERT INTO sr_user_reputation SET reputation=5, user_id='".$user_id."' , reputation_type=3 , datetime ='".DATE_TIME."' , status='1'");			}		}else{			mysql_query("DELETE FROM sr_user_reputation WHERE user_id='".$user_id."' AND reputation_type=3");		}				/**********STICKERS		$sickerQuery =mysql_query("SELECT user_sticker_id FROM sr_user_sticker WHERE sticker_id = 5 AND user_id = '".$user_id."'");		if(mysql_num_rows($sickerQuery) == 0) {			$profileQuery=mysql_query("SELECT user_id FROM sr_users WHERE user_id = '".$user_id."' AND about_me != '' AND looking_for != ''");			$profileCount=mysql_num_rows($profileQuery);			if($profileCount){				mysql_query("INSERT INTO `sr_user_sticker` SET sticker_id = 5 , user_id = '".$user_id."' , awarded_on ='".DATE_TIME."'");			}		}**************/		echo 1;	}else {		echo 0;	}}/*############################PERSONAL INFORMATION#########################################*/if(isset($_POST['action']) && $_POST['action']=='savePersonalInfo'){	$sexuality=$_POST['sexuality'];	$relationship_status=$_POST['relationship_status'];	$star_sign=$_POST['star_sign'];	$body_type=$_POST['body_type'];	$complexion=$_POST['complexion'];	$height=$_POST['height'];	$eye_color=$_POST['eye_color'];	$hair_color=$_POST['hair_color'];	$smoking=$_POST['smoking'];	$drinking=$_POST['drinking'];	$kids=$_POST['kids'];	$education=mysql_real_escape_string($_POST['education']);	$work=mysql_real_escape_string($_POST['work']);	$income=mysql_real_escape_string($_POST['income']);	$company=mysql_real_escape_string($_POST['company']);	$language = explode(',' , $_POST['language']);	$query=mysql_query("UPDATE `sr_users` SET sexuality = '".$sexuality."', 		relationship_status = '".$relationship_status."', star_sign = '".$star_sign."', 		body_type = '".$body_type."',complexion = '".$complexion."',height = '".$height."', 		eye_color = '".$eye_color."',hair_color = '".$hair_color."',language = '".$language."', 		smoking = '".$smoking."',drinking = '".$drinking."',kids = '".$kids."',		education = '".$education."',work = '".$work."',income = '".$income."',		company = '".$company."' WHERE user_id='".$user_id."'"); 	if($query){		$deleteLanQuery = mysql_query("DELETE FROM sr_user_language WHERE user_id='".$user_id."'");		if($deleteLanQuery){			foreach($language as $language_id){				mysql_query("INSERT INTO sr_user_language SET user_id='".$user_id."', 					language_id='".$language_id."'");			}		}		if($sexuality != '' AND $relationship_status != '' AND $star_sign != '' 			AND $body_type != '' AND $complexion != '' AND $height != '' 			AND $eye_color != '' AND $hair_color != '' AND $language != '' 			AND $smoking != '' AND $drinking != '' AND $kids != '' AND$education != '' 			AND $work !=''){			$repQuery=mysql_query("SELECT * FROM sr_user_reputation WHERE user_id='".$user_id."' 				AND reputation_type=1 AND status='1'");			if(mysql_num_rows($repQuery) == 0){				mysql_query("INSERT INTO sr_user_reputation SET reputation=5 , 					user_id='".$user_id."' , reputation_type=1 , datetime ='".DATE_TIME."' , 					status='1'");			}		}else{			mysql_query("DELETE FROM sr_user_reputation WHERE user_id='".$user_id."' 				AND reputation_type=1");		}		$userResult = $userProfileObj->getUserInfo($user_id);				?>		<div class="row">			<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">				<ul>					<li>						<div class="que">Relationship Status:</div>						<div><?php echo $userProfileObj->getRelationshipName($userResult['relationship_status']);?></div>					</li>					<li>						<div class="que">Star Sign:</div>						<div><?php echo $userProfileObj->getstarSignName($userResult['star_sign']);?></div>					</li>					<li>						<div class="que">Sexuality:</div>						<div><?php echo  $userProfileObj->getSexualityName($userResult['sexuality']); ?></div>					</li>					<li>						<div class="que">Body Type:</div>						<div><?php echo $userProfileObj->getBodyTypeName($userResult['body_type']);?></div>					</li>					<li>						<div class="que">Complexion:</div>						<div><?php echo $userProfileObj->getComplexionName($userResult['complexion']);?></div>					</li>					<li>						<div class="que">Height:</div>						<div><?php if($userResult['height'] != 0) echo $userResult['height'];?> cm</div>					</li>					<li>						<div class="que">Eye Color:</div>						<div><?php echo $userProfileObj->getEyeColorName($userResult['eye_color']);?></div>					</li>					<li>						<div class="que">Hair Color:</div>						<div><?php echo $userProfileObj->getHairColorName($userResult['hair_color']);?></div>					</li>				</ul>			</div>			<div class="col-lg-6 col-md-6 col-sm-6 col-xs-12">				<ul>					<li>						<div class="que">Languages:</div>						<div><?php							$userLanguageArray = $userProfileObj->getUserLanguage($user_id);							$pre='';							foreach($userLanguageArray as $language_id)							{								echo $pre.$userProfileObj->getLanguageName($language_id);								$pre = ', ';							}?></div>					</li>					<li>						<div class="que">Smoking:</div>						<div><?php if($userResult['smoking'] ==1) { echo 'Yes'; } else if($userResult['smoking'] ==0){ echo 'No';} ?></div>					</li>					<li>						<div class="que">Drinking:</div>						<div><?php if($userResult['drinking'] ==1) { echo 'Yes'; } else if($userResult['drinking'] ==0){ echo 'No';} ?></div>					</li>					<li>						<div class="que">Kids:</div>						<div><?php if($userResult['kids'] ==1) { echo 'Yes'; } else if($userResult['kids'] ==2){ echo 'No';} ?></div>					</li>					<li>						<div class="que">Education:</div>						<div><?php echo $userProfileObj->getEducationName($userResult['education']);?></div>					</li>					<li>						<div class="que">Work:</div>						<div><?php echo $userResult['work'];?></div>					</li>					<li>						<div class="que">Income:</div>						<div><?php echo $userProfileObj->getIncomeName($userResult['income']);?>							</div>					</li>					<li>						<div class="que">Company:</div>						<div><?php echo $userResult['company'];?></div>					</li>				</ul>			</div>		</div>	<?php }else {		echo 0;	}}if(isset($_POST['action']) && $_POST['action'] == 'getPercentage'){	$userResult = $userProfileObj->getUserInfo($user_id);	$percentage = $userProfileObj->getProfilePercent($userResult);	echo $percentage;}/*Updates by Chitra 23/05/2017 for checking restricted user names*/if(isset($_POST['action']) && $_POST['action'] == 'checkusername'){	$username = $_POST['username'];	$query = mysql_query("select `user_name` from `sr_restricted_name` 		where `user_name` = '".$username."' and `status` = 1 ");	$row = mysql_num_rows($query);	if($row > 0){		echo "1";	}	else{		echo "0";	}}?>